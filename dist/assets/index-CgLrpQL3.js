var sa=Object.defineProperty;var Fo=d=>{throw TypeError(d)};var ra=(d,n,o)=>n in d?sa(d,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[n]=o;var Ji=(d,n,o)=>ra(d,typeof n!="symbol"?n+"":n,o),Xi=(d,n,o)=>n.has(d)||Fo("Cannot "+o);var f=(d,n,o)=>(Xi(d,n,"read from private field"),o?o.call(d):n.get(d)),I=(d,n,o)=>n.has(d)?Fo("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(d):n.set(d,o),z=(d,n,o,a)=>(Xi(d,n,"write to private field"),a?a.call(d,o):n.set(d,o),o),w=(d,n,o)=>(Xi(d,n,"access private method"),o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&a(g)}).observe(document,{childList:!0,subtree:!0});function o(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(l){if(l.ep)return;l.ep=!0;const u=o(l);fetch(l.href,u)}})();const qt={BASE_URL:"https://story-api.dicoding.dev/v1",VAPID_API_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",MAP_TILLER_URL:"https://api.maptiler.com/geocoding",MAP_TILLER_API_KEY:"Kb29jRhBtXr8rf5YsLeL"},aa={STORIES:`${qt.BASE_URL}/stories`};async function la(d){try{const n=await fetch(aa.STORIES,{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return await n.json()}catch(n){throw console.error("Error fetching story data:",n),n}}async function ca(d,n){try{const o=`${qt.MAP_TILLER_URL}/${d},${n}.json?key=${qt.MAP_TILLER_API_KEY}`,a=await fetch(o,{method:"GET"});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(o){throw console.error("Error fetching reverse geocode data:",o),o}}async function vn(d,n){try{const o=await ca(d,n);if(o&&o.features&&o.features.length>0){const a=o.features;let l=a.find(u=>u.place_type&&u.place_type.includes("subregion"));return l||(l=a.find(u=>u.place_type&&u.place_type.includes("place"))),l||(l=a.find(u=>u.properties&&u.properties["osm:place_type"]==="city")),l||(l=a.find(u=>u.place_type&&u.place_type.includes("municipal_district"))),l?l.text||l.place_name:a[0].text||a[0].place_name||"Unknown location"}return"Location not found"}catch(o){throw console.error("Error getting city name:",o),o}}const nn=(d,n)=>n.some(o=>d instanceof o);let Ho,Uo;function ha(){return Ho||(Ho=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ua(){return Uo||(Uo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const on=new WeakMap,Qi=new WeakMap,di=new WeakMap;function da(d){const n=new Promise((o,a)=>{const l=()=>{d.removeEventListener("success",u),d.removeEventListener("error",g)},u=()=>{o(ce(d.result)),l()},g=()=>{a(d.error),l()};d.addEventListener("success",u),d.addEventListener("error",g)});return di.set(n,d),n}function fa(d){if(on.has(d))return;const n=new Promise((o,a)=>{const l=()=>{d.removeEventListener("complete",u),d.removeEventListener("error",g),d.removeEventListener("abort",g)},u=()=>{o(),l()},g=()=>{a(d.error||new DOMException("AbortError","AbortError")),l()};d.addEventListener("complete",u),d.addEventListener("error",g),d.addEventListener("abort",g)});on.set(d,n)}let sn={get(d,n,o){if(d instanceof IDBTransaction){if(n==="done")return on.get(d);if(n==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return ce(d[n])},set(d,n,o){return d[n]=o,!0},has(d,n){return d instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in d}};function Ko(d){sn=d(sn)}function ma(d){return ua().includes(d)?function(...n){return d.apply(rn(this),n),ce(this.request)}:function(...n){return ce(d.apply(rn(this),n))}}function pa(d){return typeof d=="function"?ma(d):(d instanceof IDBTransaction&&fa(d),nn(d,ha())?new Proxy(d,sn):d)}function ce(d){if(d instanceof IDBRequest)return da(d);if(Qi.has(d))return Qi.get(d);const n=pa(d);return n!==d&&(Qi.set(d,n),di.set(n,d)),n}const rn=d=>di.get(d);function ga(d,n,{blocked:o,upgrade:a,blocking:l,terminated:u}={}){const g=indexedDB.open(d,n),b=ce(g);return a&&g.addEventListener("upgradeneeded",v=>{a(ce(g.result),v.oldVersion,v.newVersion,ce(g.transaction),v)}),o&&g.addEventListener("blocked",v=>o(v.oldVersion,v.newVersion,v)),b.then(v=>{u&&v.addEventListener("close",()=>u()),l&&v.addEventListener("versionchange",A=>l(A.oldVersion,A.newVersion,A))}).catch(()=>{}),b}const _a=["get","getKey","getAll","getAllKeys","count"],va=["put","add","delete","clear"],tn=new Map;function qo(d,n){if(!(d instanceof IDBDatabase&&!(n in d)&&typeof n=="string"))return;if(tn.get(n))return tn.get(n);const o=n.replace(/FromIndex$/,""),a=n!==o,l=va.includes(o);if(!(o in(a?IDBIndex:IDBObjectStore).prototype)||!(l||_a.includes(o)))return;const u=async function(g,...b){const v=this.transaction(g,l?"readwrite":"readonly");let A=v.store;return a&&(A=A.index(b.shift())),(await Promise.all([A[o](...b),l&&v.done]))[0]};return tn.set(n,u),u}Ko(d=>({...d,get:(n,o,a)=>qo(n,o)||d.get(n,o,a),has:(n,o)=>!!qo(n,o)||d.has(n,o)}));const ya=["continue","continuePrimaryKey","advance"],Wo={},an=new WeakMap,Yo=new WeakMap,wa={get(d,n){if(!ya.includes(n))return d[n];let o=Wo[n];return o||(o=Wo[n]=function(...a){an.set(this,Yo.get(this)[n](...a))}),o}};async function*ba(...d){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...d)),!n)return;n=n;const o=new Proxy(n,wa);for(Yo.set(o,n),di.set(o,rn(n));n;)yield o,n=await(an.get(o)||n.continue()),an.delete(o)}function Go(d,n){return n===Symbol.asyncIterator&&nn(d,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&nn(d,[IDBIndex,IDBObjectStore])}Ko(d=>({...d,get(n,o,a){return Go(n,o)?ba:d.get(n,o,a)},has(n,o){return Go(n,o)||d.has(n,o)}}));const La="Story",xa=2,ye="saved-stories",li=ga(La,xa,{upgrade:d=>{d.objectStoreNames.contains(ye)||d.createObjectStore(ye,{keyPath:"id"})}}),Ze={async putStory(d){if(!Object.hasOwn(d,"id"))throw new Error("`id` is required to save.");return(await li).put(ye,d)},async getStoryById(d){if(!d)throw new Error("`id` is required.");return(await li).get(ye,d)},async getAllStory(){return(await li).getAll(ye)},async removeStory(d){return(await li).delete(ye,d)}};class yn{constructor(){this.currentModal=null,this.currentEscapeHandler=null}formatDate(n){return new Date(n).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}async getLocationName(n,o){if(n==null||o==null||typeof n!="number"||typeof o!="number")return"Unknown Location";try{return await vn(o,n)}catch(a){return console.error("Error getting location:",a),`${n.toFixed(4)}, ${o.toFixed(4)}`}}async checkIfStorySaved(n){try{return await Ze.getStoryById(n)!==void 0}catch(o){return console.error("Error checking saved story:",o),!1}}async saveStory(n){try{const o={...n};if(!o.photoBlob&&o.photoUrl)try{const a=await fetch(o.photoUrl,{cache:"force-cache"});if(a.ok){const l=await a.blob();l&&l.size>0&&(o.photoBlob=l,o.photoMime=l.type||null)}}catch(a){console.warn("Failed to cache story image for offline use:",a)}return await Ze.putStory(o),!0}catch(o){return console.error("Error saving story:",o),!1}}async unsaveStory(n){try{return await Ze.removeStory(n),!0}catch(o){return console.error("Error removing story:",o),!1}}async updateSaveButton(n,o){await this.checkIfStorySaved(o.id)?(n.innerHTML='Hapus dari Tersimpan <i class="fas fa-bookmark"></i>',n.classList.remove("btn-transparent"),n.classList.add("btn-success"),n.dataset.saved="true"):(n.innerHTML='Simpan Story <i class="far fa-bookmark"></i>',n.classList.remove("btn-success"),n.classList.add("btn-transparent"),n.dataset.saved="false")}async show(n,o=null){if(this.close(),!n||!n.id)return console.error("Story object must have an id property"),null;let a="Loading location...";if(n.lat&&n.lon)try{a=await this.getLocationName(n.lat,n.lon)}catch{a=`${n.lat.toFixed(4)}, ${n.lon.toFixed(4)}`}const l=document.createElement("div");return l.className="story-modal-overlay",l.innerHTML=`
      <div class="story-modal-content">
        <div class="story-modal-image-container">
          <img src="${n.photoUrl}" alt="${n.name}" class="story-modal-image">
          <button class="story-modal-close-btn" type="button">√ó</button>
        </div>
        <div class="story-modal-body">
          <h2 class="story-modal-title">${n.name}</h2>
          <p class="story-modal-description">${n.description}</p>
          <div class="story-modal-divider">
            <div class="story-modal-meta">
              <span class="story-modal-meta-icon">üìç</span>
              <span>${a}</span>
            </div>
            <div class="story-modal-meta">
              <span class="story-modal-meta-icon">üïí</span>
              <span>${this.formatDate(n.createdAt)}</span>
            </div>
            <button id="story-detail-save" class="btn btn-transparent" data-saved="false">
                Simpan Story <i class="far fa-bookmark"></i>
            </button>

            ${n.lat&&n.lon&&o?`
              <div class="story-modal-actions">
                <button class="story-modal-btn story-modal-btn--primary" data-action="show-on-map" type="button">
                  Show on Map
                </button>
                <button class="story-modal-btn story-modal-btn--success" data-action="satellite-view" type="button">
                  Satellite View
                </button>
              </div>
            `:""}
          </div>
        </div>
      </div>
    `,this.currentModal=l,await this.setupEventListeners(l,n,o),document.body.appendChild(l),requestAnimationFrame(()=>{l.style.opacity="1"}),l}async setupEventListeners(n,o,a){const l=n.querySelector(".story-modal-close-btn");l&&l.addEventListener("click",()=>this.close()),n.addEventListener("click",A=>{A.target===n&&this.close()});const u=n.querySelector("#story-detail-save");u&&(await this.updateSaveButton(u,o),u.addEventListener("click",async()=>{const A=u.dataset.saved==="true";u.disabled=!0;const W=u.innerHTML;u.innerHTML='Loading... <i class="fas fa-spinner fa-spin"></i>';try{let B=!1;A?(B=await this.unsaveStory(o.id),B?this.showToast("Story berhasil dihapus dari tersimpan","success"):this.showToast("Gagal menghapus story dari tersimpan","error")):(B=await this.saveStory(o),B?this.showToast("Story berhasil disimpan","success"):this.showToast("Gagal menyimpan story","error")),B?await this.updateSaveButton(u,o):u.innerHTML=W}catch(B){console.error("Error handling save/unsave:",B),this.showToast("Terjadi kesalahan","error"),u.innerHTML=W}finally{u.disabled=!1}}));const g=n.querySelector('[data-action="show-on-map"]'),b=n.querySelector('[data-action="satellite-view"]');g&&a&&g.addEventListener("click",()=>{this.focusOnStory(o,a),this.close()}),b&&a&&b.addEventListener("click",()=>{a.switchToLayer("Satellite"),this.focusOnStory(o,a),this.close()});const v=A=>{A.key==="Escape"&&(this.close(),document.removeEventListener("keydown",v))};document.addEventListener("keydown",v),this.currentEscapeHandler=v}showToast(n,o="info"){const a=document.createElement("div");a.className=`toast toast-${o}`,a.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      background: ${o==="success"?"#4CAF50":o==="error"?"#f44336":"#2196F3"};
      color: white;
      border-radius: 4px;
      z-index: 10001;
      opacity: 0;
      transition: opacity 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    `,a.textContent=n,document.body.appendChild(a),requestAnimationFrame(()=>{a.style.opacity="1"}),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)},3e3)}focusOnStory(n,o){o&&n.lat&&n.lon&&o.changeCamera([n.lat,n.lon],12)}close(){this.currentModal&&(this.currentModal.style.opacity="0",setTimeout(()=>{this.currentModal&&this.currentModal.parentNode&&this.currentModal.parentNode.removeChild(this.currentModal),this.currentModal=null},300),this.currentEscapeHandler&&(document.removeEventListener("keydown",this.currentEscapeHandler),this.currentEscapeHandler=null))}static async showStory(n,o=null){return await new yn().show(n,o)}}var Re={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var Sa=Re.exports,Vo;function Pa(){return Vo||(Vo=1,function(d,n){(function(o,a){a(n)})(Sa,function(o){var a="1.9.4";function l(t){var e,i,s,r;for(i=1,s=arguments.length;i<s;i++){r=arguments[i];for(e in r)t[e]=r[e]}return t}var u=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function g(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var s=i.call(arguments,2);return function(){return t.apply(e,s.length?s.concat(i.call(arguments)):arguments)}}var b=0;function v(t){return"_leaflet_id"in t||(t._leaflet_id=++b),t._leaflet_id}function A(t,e,i){var s,r,c,h;return h=function(){s=!1,r&&(c.apply(i,r),r=!1)},c=function(){s?r=arguments:(t.apply(i,arguments),setTimeout(h,e),s=!0)},c}function W(t,e,i){var s=e[1],r=e[0],c=s-r;return t===s&&i?t:((t-r)%c+c)%c+r}function B(){return!1}function ut(t,e){if(e===!1)return t;var i=Math.pow(10,e===void 0?6:e);return Math.round(t*i)/i}function fi(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function ee(t){return fi(t).split(/\s+/)}function F(t,e){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?u(t.options):{});for(var i in e)t.options[i]=e[i];return t.options}function xn(t,e,i){var s=[];for(var r in t)s.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(!e||e.indexOf("?")===-1?"?":"&")+s.join("&")}var Is=/\{ *([\w_ -]+) *\}/g;function Sn(t,e){return t.replace(Is,function(i,s){var r=e[s];if(r===void 0)throw new Error("No value provided for variable "+i);return typeof r=="function"&&(r=r(e)),r})}var xt=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function mi(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}var Ue="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function pi(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var Pn=0;function Tn(t){var e=+new Date,i=Math.max(0,16-(e-Pn));return Pn=e+i,window.setTimeout(t,i)}var gi=window.requestAnimationFrame||pi("RequestAnimationFrame")||Tn,kn=window.cancelAnimationFrame||pi("CancelAnimationFrame")||pi("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function ot(t,e,i){if(i&&gi===Tn)t.call(e);else return gi.call(window,g(t,e))}function pt(t){t&&kn.call(window,t)}var Bs={__proto__:null,extend:l,create:u,bind:g,get lastId(){return b},stamp:v,throttle:A,wrapNum:W,falseFn:B,formatNum:ut,trim:fi,splitWords:ee,setOptions:F,getParamString:xn,template:Sn,isArray:xt,indexOf:mi,emptyImageUrl:Ue,requestFn:gi,cancelFn:kn,requestAnimFrame:ot,cancelAnimFrame:pt};function Ot(){}Ot.extend=function(t){var e=function(){F(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,s=u(i);s.constructor=e,e.prototype=s;for(var r in this)Object.prototype.hasOwnProperty.call(this,r)&&r!=="prototype"&&r!=="__super__"&&(e[r]=this[r]);return t.statics&&l(e,t.statics),t.includes&&(zs(t.includes),l.apply(null,[s].concat(t.includes))),l(s,t),delete s.statics,delete s.includes,s.options&&(s.options=i.options?u(i.options):{},l(s.options,t.options)),s._initHooks=[],s.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var c=0,h=s._initHooks.length;c<h;c++)s._initHooks[c].call(this)}},e},Ot.include=function(t){var e=this.prototype.options;return l(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},Ot.mergeOptions=function(t){return l(this.prototype.options,t),this},Ot.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i=typeof t=="function"?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};function zs(t){if(!(typeof L>"u"||!L||!L.Mixin)){t=xt(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var dt={on:function(t,e,i){if(typeof t=="object")for(var s in t)this._on(s,t[s],e);else{t=ee(t);for(var r=0,c=t.length;r<c;r++)this._on(t[r],e,i)}return this},off:function(t,e,i){if(!arguments.length)delete this._events;else if(typeof t=="object")for(var s in t)this._off(s,t[s],e);else{t=ee(t);for(var r=arguments.length===1,c=0,h=t.length;c<h;c++)r?this._off(t[c]):this._off(t[c],e,i)}return this},_on:function(t,e,i,s){if(typeof e!="function"){console.warn("wrong listener type: "+typeof e);return}if(this._listens(t,e,i)===!1){i===this&&(i=void 0);var r={fn:e,ctx:i};s&&(r.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(r)}},_off:function(t,e,i){var s,r,c;if(this._events&&(s=this._events[t],!!s)){if(arguments.length===1){if(this._firingCount)for(r=0,c=s.length;r<c;r++)s[r].fn=B;delete this._events[t];return}if(typeof e!="function"){console.warn("wrong listener type: "+typeof e);return}var h=this._listens(t,e,i);if(h!==!1){var m=s[h];this._firingCount&&(m.fn=B,this._events[t]=s=s.slice()),s.splice(h,1)}}},fire:function(t,e,i){if(!this.listens(t,i))return this;var s=l({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var r=this._events[t];if(r){this._firingCount=this._firingCount+1||1;for(var c=0,h=r.length;c<h;c++){var m=r[c],p=m.fn;m.once&&this.off(t,p,m.ctx),p.call(m.ctx||this,s)}this._firingCount--}}return i&&this._propagateEvent(s),this},listens:function(t,e,i,s){typeof t!="string"&&console.warn('"string" type argument expected');var r=e;typeof e!="function"&&(s=!!e,r=void 0,i=void 0);var c=this._events&&this._events[t];if(c&&c.length&&this._listens(t,r,i)!==!1)return!0;if(s){for(var h in this._eventParents)if(this._eventParents[h].listens(t,e,i,s))return!0}return!1},_listens:function(t,e,i){if(!this._events)return!1;var s=this._events[t]||[];if(!e)return!!s.length;i===this&&(i=void 0);for(var r=0,c=s.length;r<c;r++)if(s[r].fn===e&&s[r].ctx===i)return r;return!1},once:function(t,e,i){if(typeof t=="object")for(var s in t)this._on(s,t[s],e,!0);else{t=ee(t);for(var r=0,c=t.length;r<c;r++)this._on(t[r],e,i,!0)}return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[v(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[v(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,l({layer:t.target,propagatedFrom:t.target},t),!0)}};dt.addEventListener=dt.on,dt.removeEventListener=dt.clearAllEventListeners=dt.off,dt.addOneTimeEventListener=dt.once,dt.fireEvent=dt.fire,dt.hasEventListeners=dt.listens;var be=Ot.extend(dt);function T(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}var Cn=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};T.prototype={clone:function(){return new T(this.x,this.y)},add:function(t){return this.clone()._add(P(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(P(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new T(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new T(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Cn(this.x),this.y=Cn(this.y),this},distanceTo:function(t){t=P(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=P(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=P(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+ut(this.x)+", "+ut(this.y)+")"}};function P(t,e,i){return t instanceof T?t:xt(t)?new T(t[0],t[1]):t==null?t:typeof t=="object"&&"x"in t&&"y"in t?new T(t.x,t.y):new T(t,e,i)}function H(t,e){if(t)for(var i=e?[t,e]:t,s=0,r=i.length;s<r;s++)this.extend(i[s])}H.prototype={extend:function(t){var e,i;if(!t)return this;if(t instanceof T||typeof t[0]=="number"||"x"in t)e=i=P(t);else if(t=st(t),e=t.min,i=t.max,!e||!i)return this;return!this.min&&!this.max?(this.min=e.clone(),this.max=i.clone()):(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)),this},getCenter:function(t){return P((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return P(this.min.x,this.max.y)},getTopRight:function(){return P(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return typeof t[0]=="number"||t instanceof T?t=P(t):t=st(t),t instanceof H?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=st(t);var e=this.min,i=this.max,s=t.min,r=t.max,c=r.x>=e.x&&s.x<=i.x,h=r.y>=e.y&&s.y<=i.y;return c&&h},overlaps:function(t){t=st(t);var e=this.min,i=this.max,s=t.min,r=t.max,c=r.x>e.x&&s.x<i.x,h=r.y>e.y&&s.y<i.y;return c&&h},isValid:function(){return!!(this.min&&this.max)},pad:function(t){var e=this.min,i=this.max,s=Math.abs(e.x-i.x)*t,r=Math.abs(e.y-i.y)*t;return st(P(e.x-s,e.y-r),P(i.x+s,i.y+r))},equals:function(t){return t?(t=st(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight())):!1}};function st(t,e){return!t||t instanceof H?t:new H(t,e)}function rt(t,e){if(t)for(var i=e?[t,e]:t,s=0,r=i.length;s<r;s++)this.extend(i[s])}rt.prototype={extend:function(t){var e=this._southWest,i=this._northEast,s,r;if(t instanceof N)s=t,r=t;else if(t instanceof rt){if(s=t._southWest,r=t._northEast,!s||!r)return this}else return t?this.extend(O(t)||j(t)):this;return!e&&!i?(this._southWest=new N(s.lat,s.lng),this._northEast=new N(r.lat,r.lng)):(e.lat=Math.min(s.lat,e.lat),e.lng=Math.min(s.lng,e.lng),i.lat=Math.max(r.lat,i.lat),i.lng=Math.max(r.lng,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,s=Math.abs(e.lat-i.lat)*t,r=Math.abs(e.lng-i.lng)*t;return new rt(new N(e.lat-s,e.lng-r),new N(i.lat+s,i.lng+r))},getCenter:function(){return new N((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new N(this.getNorth(),this.getWest())},getSouthEast:function(){return new N(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){typeof t[0]=="number"||t instanceof N||"lat"in t?t=O(t):t=j(t);var e=this._southWest,i=this._northEast,s,r;return t instanceof rt?(s=t.getSouthWest(),r=t.getNorthEast()):s=r=t,s.lat>=e.lat&&r.lat<=i.lat&&s.lng>=e.lng&&r.lng<=i.lng},intersects:function(t){t=j(t);var e=this._southWest,i=this._northEast,s=t.getSouthWest(),r=t.getNorthEast(),c=r.lat>=e.lat&&s.lat<=i.lat,h=r.lng>=e.lng&&s.lng<=i.lng;return c&&h},overlaps:function(t){t=j(t);var e=this._southWest,i=this._northEast,s=t.getSouthWest(),r=t.getNorthEast(),c=r.lat>e.lat&&s.lat<i.lat,h=r.lng>e.lng&&s.lng<i.lng;return c&&h},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return t?(t=j(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function j(t,e){return t instanceof rt?t:new rt(t,e)}function N(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,i!==void 0&&(this.alt=+i)}N.prototype={equals:function(t,e){if(!t)return!1;t=O(t);var i=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return i<=(e===void 0?1e-9:e)},toString:function(t){return"LatLng("+ut(this.lat,t)+", "+ut(this.lng,t)+")"},distanceTo:function(t){return Wt.distance(this,O(t))},wrap:function(){return Wt.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return j([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new N(this.lat,this.lng,this.alt)}};function O(t,e,i){return t instanceof N?t:xt(t)&&typeof t[0]!="object"?t.length===3?new N(t[0],t[1],t[2]):t.length===2?new N(t[0],t[1]):null:t==null?t:typeof t=="object"&&"lat"in t?new N(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===void 0?null:new N(t,e,i)}var Dt={latLngToPoint:function(t,e){var i=this.projection.project(t),s=this.scale(e);return this.transformation._transform(i,s)},pointToLatLng:function(t,e){var i=this.scale(e),s=this.transformation.untransform(t,i);return this.projection.unproject(s)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t),s=this.transformation.transform(e.min,i),r=this.transformation.transform(e.max,i);return new H(s,r)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?W(t.lng,this.wrapLng,!0):t.lng,i=this.wrapLat?W(t.lat,this.wrapLat,!0):t.lat,s=t.alt;return new N(i,e,s)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),s=e.lat-i.lat,r=e.lng-i.lng;if(s===0&&r===0)return t;var c=t.getSouthWest(),h=t.getNorthEast(),m=new N(c.lat-s,c.lng-r),p=new N(h.lat-s,h.lng-r);return new rt(m,p)}},Wt=l({},Dt,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,s=t.lat*i,r=e.lat*i,c=Math.sin((e.lat-t.lat)*i/2),h=Math.sin((e.lng-t.lng)*i/2),m=c*c+Math.cos(s)*Math.cos(r)*h*h,p=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m));return this.R*p}}),En=6378137,_i={R:En,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,s=Math.max(Math.min(i,t.lat),-i),r=Math.sin(s*e);return new T(this.R*t.lng*e,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(t){var e=180/Math.PI;return new N((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=En*Math.PI;return new H([-t,-t],[t,t])}()};function vi(t,e,i,s){if(xt(t)){this._a=t[0],this._b=t[1],this._c=t[2],this._d=t[3];return}this._a=t,this._b=e,this._c=i,this._d=s}vi.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new T((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};function Le(t,e,i,s){return new vi(t,e,i,s)}var yi=l({},Wt,{code:"EPSG:3857",projection:_i,transformation:function(){var t=.5/(Math.PI*_i.R);return Le(t,.5,-t,.5)}()}),Os=l({},yi,{code:"EPSG:900913"});function Mn(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function An(t,e){var i="",s,r,c,h,m,p;for(s=0,c=t.length;s<c;s++){for(m=t[s],r=0,h=m.length;r<h;r++)p=m[r],i+=(r?"L":"M")+p.x+" "+p.y;i+=e?x.svg?"z":"x":""}return i||"M0 0"}var wi=document.documentElement.style,qe="ActiveXObject"in window,Ds=qe&&!document.addEventListener,In="msLaunchUri"in navigator&&!("documentMode"in document),bi=Et("webkit"),Bn=Et("android"),zn=Et("android 2")||Et("android 3"),Rs=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ns=Bn&&Et("Google")&&Rs<537&&!("AudioNode"in window),Li=!!window.opera,On=!In&&Et("chrome"),Dn=Et("gecko")&&!bi&&!Li&&!qe,Zs=!On&&Et("safari"),Rn=Et("phantom"),Nn="OTransition"in wi,Fs=navigator.platform.indexOf("Win")===0,Zn=qe&&"transition"in wi,xi="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!zn,Fn="MozPerspective"in wi,Hs=!window.L_DISABLE_3D&&(Zn||xi||Fn)&&!Nn&&!Rn,xe=typeof orientation<"u"||Et("mobile"),Us=xe&&bi,qs=xe&&xi,Hn=!window.PointerEvent&&window.MSPointerEvent,Un=!!(window.PointerEvent||Hn),qn="ontouchstart"in window||!!window.TouchEvent,Ws=!window.L_NO_TOUCH&&(qn||Un),Gs=xe&&Li,Vs=xe&&Dn,js=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,$s=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",B,e),window.removeEventListener("testPassiveEventSupport",B,e)}catch{}return t}(),Ks=function(){return!!document.createElement("canvas").getContext}(),Si=!!(document.createElementNS&&Mn("svg").createSVGRect),Ys=!!Si&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Js=!Si&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&typeof e.adj=="object"}catch{return!1}}(),Xs=navigator.platform.indexOf("Mac")===0,Qs=navigator.platform.indexOf("Linux")===0;function Et(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var x={ie:qe,ielt9:Ds,edge:In,webkit:bi,android:Bn,android23:zn,androidStock:Ns,opera:Li,chrome:On,gecko:Dn,safari:Zs,phantom:Rn,opera12:Nn,win:Fs,ie3d:Zn,webkit3d:xi,gecko3d:Fn,any3d:Hs,mobile:xe,mobileWebkit:Us,mobileWebkit3d:qs,msPointer:Hn,pointer:Un,touch:Ws,touchNative:qn,mobileOpera:Gs,mobileGecko:Vs,retina:js,passiveEvents:$s,canvas:Ks,svg:Si,vml:Js,inlineSvg:Ys,mac:Xs,linux:Qs},Wn=x.msPointer?"MSPointerDown":"pointerdown",Gn=x.msPointer?"MSPointerMove":"pointermove",Vn=x.msPointer?"MSPointerUp":"pointerup",jn=x.msPointer?"MSPointerCancel":"pointercancel",Pi={touchstart:Wn,touchmove:Gn,touchend:Vn,touchcancel:jn},$n={touchstart:sr,touchmove:We,touchend:We,touchcancel:We},he={},Kn=!1;function tr(t,e,i){return e==="touchstart"&&or(),$n[e]?(i=$n[e].bind(this,i),t.addEventListener(Pi[e],i,!1),i):(console.warn("wrong event specified:",e),B)}function er(t,e,i){if(!Pi[e]){console.warn("wrong event specified:",e);return}t.removeEventListener(Pi[e],i,!1)}function ir(t){he[t.pointerId]=t}function nr(t){he[t.pointerId]&&(he[t.pointerId]=t)}function Yn(t){delete he[t.pointerId]}function or(){Kn||(document.addEventListener(Wn,ir,!0),document.addEventListener(Gn,nr,!0),document.addEventListener(Vn,Yn,!0),document.addEventListener(jn,Yn,!0),Kn=!0)}function We(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){e.touches=[];for(var i in he)e.touches.push(he[i]);e.changedTouches=[e],t(e)}}function sr(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&Q(e),We(t,e)}function rr(t){var e={},i,s;for(s in t)i=t[s],e[s]=i&&i.bind?i.bind(t):i;return t=e,e.type="dblclick",e.detail=2,e.isTrusted=!1,e._simulated=!0,e}var ar=200;function lr(t,e){t.addEventListener("dblclick",e);var i=0,s;function r(c){if(c.detail!==1){s=c.detail;return}if(!(c.pointerType==="mouse"||c.sourceCapabilities&&!c.sourceCapabilities.firesTouchEvents)){var h=eo(c);if(!(h.some(function(p){return p instanceof HTMLLabelElement&&p.attributes.for})&&!h.some(function(p){return p instanceof HTMLInputElement||p instanceof HTMLSelectElement}))){var m=Date.now();m-i<=ar?(s++,s===2&&e(rr(c))):s=1,i=m}}}return t.addEventListener("click",r),{dblclick:e,simDblclick:r}}function cr(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}var Ti=je(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Se=je(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Jn=Se==="webkitTransition"||Se==="OTransition"?Se+"End":"transitionend";function Xn(t){return typeof t=="string"?document.getElementById(t):t}function Pe(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||i==="auto")&&document.defaultView){var s=document.defaultView.getComputedStyle(t,null);i=s?s[e]:null}return i==="auto"?null:i}function R(t,e,i){var s=document.createElement(t);return s.className=e||"",i&&i.appendChild(s),s}function U(t){var e=t.parentNode;e&&e.removeChild(t)}function Ge(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function ue(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function de(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function ki(t,e){if(t.classList!==void 0)return t.classList.contains(e);var i=Ve(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function C(t,e){if(t.classList!==void 0)for(var i=ee(e),s=0,r=i.length;s<r;s++)t.classList.add(i[s]);else if(!ki(t,e)){var c=Ve(t);Ci(t,(c?c+" ":"")+e)}}function G(t,e){t.classList!==void 0?t.classList.remove(e):Ci(t,fi((" "+Ve(t)+" ").replace(" "+e+" "," ")))}function Ci(t,e){t.className.baseVal===void 0?t.className=e:t.className.baseVal=e}function Ve(t){return t.correspondingElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function gt(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&hr(t,e)}function hr(t,e){var i=!1,s="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(s)}catch{if(e===1)return}e=Math.round(e*100),i?(i.Enabled=e!==100,i.Opacity=e):t.style.filter+=" progid:"+s+"(opacity="+e+")"}function je(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function ie(t,e,i){var s=e||new T(0,0);t.style[Ti]=(x.ie3d?"translate("+s.x+"px,"+s.y+"px)":"translate3d("+s.x+"px,"+s.y+"px,0)")+(i?" scale("+i+")":"")}function $(t,e){t._leaflet_pos=e,x.any3d?ie(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function ne(t){return t._leaflet_pos||new T(0,0)}var Te,ke,Ei;if("onselectstart"in document)Te=function(){k(window,"selectstart",Q)},ke=function(){Z(window,"selectstart",Q)};else{var Ce=je(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Te=function(){if(Ce){var t=document.documentElement.style;Ei=t[Ce],t[Ce]="none"}},ke=function(){Ce&&(document.documentElement.style[Ce]=Ei,Ei=void 0)}}function Mi(){k(window,"dragstart",Q)}function Ai(){Z(window,"dragstart",Q)}var $e,Ii;function Bi(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&(Ke(),$e=t,Ii=t.style.outlineStyle,t.style.outlineStyle="none",k(window,"keydown",Ke))}function Ke(){$e&&($e.style.outlineStyle=Ii,$e=void 0,Ii=void 0,Z(window,"keydown",Ke))}function Qn(t){do t=t.parentNode;while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function zi(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var ur={__proto__:null,TRANSFORM:Ti,TRANSITION:Se,TRANSITION_END:Jn,get:Xn,getStyle:Pe,create:R,remove:U,empty:Ge,toFront:ue,toBack:de,hasClass:ki,addClass:C,removeClass:G,setClass:Ci,getClass:Ve,setOpacity:gt,testProp:je,setTransform:ie,setPosition:$,getPosition:ne,get disableTextSelection(){return Te},get enableTextSelection(){return ke},disableImageDrag:Mi,enableImageDrag:Ai,preventOutline:Bi,restoreOutline:Ke,getSizedParentNode:Qn,getScale:zi};function k(t,e,i,s){if(e&&typeof e=="object")for(var r in e)Di(t,r,e[r],i);else{e=ee(e);for(var c=0,h=e.length;c<h;c++)Di(t,e[c],i,s)}return this}var Mt="_leaflet_events";function Z(t,e,i,s){if(arguments.length===1)to(t),delete t[Mt];else if(e&&typeof e=="object")for(var r in e)Ri(t,r,e[r],i);else if(e=ee(e),arguments.length===2)to(t,function(m){return mi(e,m)!==-1});else for(var c=0,h=e.length;c<h;c++)Ri(t,e[c],i,s);return this}function to(t,e){for(var i in t[Mt]){var s=i.split(/\d/)[0];(!e||e(s))&&Ri(t,s,null,null,i)}}var Oi={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Di(t,e,i,s){var r=e+v(i)+(s?"_"+v(s):"");if(t[Mt]&&t[Mt][r])return this;var c=function(m){return i.call(s||t,m||window.event)},h=c;!x.touchNative&&x.pointer&&e.indexOf("touch")===0?c=tr(t,e,c):x.touch&&e==="dblclick"?c=lr(t,c):"addEventListener"in t?e==="touchstart"||e==="touchmove"||e==="wheel"||e==="mousewheel"?t.addEventListener(Oi[e]||e,c,x.passiveEvents?{passive:!1}:!1):e==="mouseenter"||e==="mouseleave"?(c=function(m){m=m||window.event,Zi(t,m)&&h(m)},t.addEventListener(Oi[e],c,!1)):t.addEventListener(e,h,!1):t.attachEvent("on"+e,c),t[Mt]=t[Mt]||{},t[Mt][r]=c}function Ri(t,e,i,s,r){r=r||e+v(i)+(s?"_"+v(s):"");var c=t[Mt]&&t[Mt][r];if(!c)return this;!x.touchNative&&x.pointer&&e.indexOf("touch")===0?er(t,e,c):x.touch&&e==="dblclick"?cr(t,c):"removeEventListener"in t?t.removeEventListener(Oi[e]||e,c,!1):t.detachEvent("on"+e,c),t[Mt][r]=null}function oe(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Ni(t){return Di(t,"wheel",oe),this}function Ee(t){return k(t,"mousedown touchstart dblclick contextmenu",oe),t._leaflet_disable_click=!0,this}function Q(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function se(t){return Q(t),oe(t),this}function eo(t){if(t.composedPath)return t.composedPath();for(var e=[],i=t.target;i;)e.push(i),i=i.parentNode;return e}function io(t,e){if(!e)return new T(t.clientX,t.clientY);var i=zi(e),s=i.boundingClientRect;return new T((t.clientX-s.left)/i.x-e.clientLeft,(t.clientY-s.top)/i.y-e.clientTop)}var dr=x.linux&&x.chrome?window.devicePixelRatio:x.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function no(t){return x.edge?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/dr:t.deltaY&&t.deltaMode===1?-t.deltaY*20:t.deltaY&&t.deltaMode===2?-t.deltaY*60:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?-t.detail*20:t.detail?t.detail/-32765*60:0}function Zi(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch{return!1}return i!==t}var fr={__proto__:null,on:k,off:Z,stopPropagation:oe,disableScrollPropagation:Ni,disableClickPropagation:Ee,preventDefault:Q,stop:se,getPropagationPath:eo,getMousePosition:io,getWheelDelta:no,isExternalTarget:Zi,addListener:k,removeListener:Z},oo=be.extend({run:function(t,e,i,s){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(s||.5,.2),this._startPos=ne(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=ot(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=this._duration*1e3;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),$(this._el,i),this.fire("step")},_complete:function(){pt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),D=be.extend({options:{crs:yi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=F(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=g(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.zoom!==void 0&&(this._zoom=this._limitZoom(e.zoom)),e.center&&e.zoom!==void 0&&this.setView(O(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Se&&x.any3d&&!x.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),k(this._proxy,Jn,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,i){if(e=e===void 0?this._zoom:this._limitZoom(e),t=this._limitCenter(O(t),e,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&i!==!0){i.animate!==void 0&&(i.zoom=l({animate:i.animate},i.zoom),i.pan=l({animate:i.animate,duration:i.duration},i.pan));var s=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,i.zoom):this._tryAnimatedPan(t,i.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e,i.pan&&i.pan.noMoveStart),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(x.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(x.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var s=this.getZoomScale(e),r=this.getSize().divideBy(2),c=t instanceof T?t:this.latLngToContainerPoint(t),h=c.subtract(r).multiplyBy(1-1/s),m=this.containerPointToLatLng(r.add(h));return this.setView(m,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():j(t);var i=P(e.paddingTopLeft||e.padding||[0,0]),s=P(e.paddingBottomRight||e.padding||[0,0]),r=this.getBoundsZoom(t,!1,i.add(s));if(r=typeof e.maxZoom=="number"?Math.min(e.maxZoom,r):r,r===1/0)return{center:t.getCenter(),zoom:r};var c=s.subtract(i).divideBy(2),h=this.project(t.getSouthWest(),r),m=this.project(t.getNorthEast(),r),p=this.unproject(h.add(m).divideBy(2).add(c),r);return{center:p,zoom:r}},fitBounds:function(t,e){if(t=j(t),!t.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=P(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new oo,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){C(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,i){if(i=i||{},i.animate===!1||!x.any3d)return this.setView(t,e,i);this._stop();var s=this.project(this.getCenter()),r=this.project(t),c=this.getSize(),h=this._zoom;t=O(t),e=e===void 0?h:e;var m=Math.max(c.x,c.y),p=m*this.getZoomScale(h,e),_=r.distanceTo(s)||1,y=1.42,S=y*y;function E(K){var ai=K?-1:1,ea=K?p:m,ia=p*p-m*m+ai*S*S*_*_,na=2*ea*S*_,Yi=ia/na,Zo=Math.sqrt(Yi*Yi+1)-Yi,oa=Zo<1e-9?-18:Math.log(Zo);return oa}function nt(K){return(Math.exp(K)-Math.exp(-K))/2}function J(K){return(Math.exp(K)+Math.exp(-K))/2}function vt(K){return nt(K)/J(K)}var at=E(0);function ve(K){return m*(J(at)/J(at+y*K))}function Jr(K){return m*(J(at)*vt(at+y*K)-nt(at))/S}function Xr(K){return 1-Math.pow(1-K,1.5)}var Qr=Date.now(),Ro=(E(1)-at)/y,ta=i.duration?1e3*i.duration:1e3*Ro*.8;function No(){var K=(Date.now()-Qr)/ta,ai=Xr(K)*Ro;K<=1?(this._flyToFrame=ot(No,this),this._move(this.unproject(s.add(r.subtract(s).multiplyBy(Jr(ai)/_)),h),this.getScaleZoom(m/ve(ai),h),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}return this._moveStart(!0,i.noMoveStart),No.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=j(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),s=this._limitCenter(i,this._zoom,j(t));return i.equals(s)||this.panTo(s,e),this._enforcingBounds=!1,this},panInside:function(t,e){e=e||{};var i=P(e.paddingTopLeft||e.padding||[0,0]),s=P(e.paddingBottomRight||e.padding||[0,0]),r=this.project(this.getCenter()),c=this.project(t),h=this.getPixelBounds(),m=st([h.min.add(i),h.max.subtract(s)]),p=m.getSize();if(!m.contains(c)){this._enforcingBounds=!0;var _=c.subtract(m.getCenter()),y=m.extend(c).getSize().subtract(p);r.x+=_.x<0?-y.x:y.x,r.y+=_.y<0?-y.y:y.y,this.panTo(this.unproject(r),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=l({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),s=e.divideBy(2).round(),r=i.divideBy(2).round(),c=s.subtract(r);return!c.x&&!c.y?this:(t.animate&&t.pan?this.panBy(c):(t.pan&&this._rawPanBy(c),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(g(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=l({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=g(this._handleGeolocationResponse,this),i=g(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,i=t.message||(e===1?"permission denied":e===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=t.coords.latitude,i=t.coords.longitude,s=new N(e,i),r=s.toBounds(t.coords.accuracy*2),c=this._locateOptions;if(c.setView){var h=this.getBoundsZoom(r);this.setView(s,c.maxZoom?Math.min(h,c.maxZoom):h)}var m={latlng:s,bounds:r,timestamp:t.timestamp};for(var p in t.coords)typeof t.coords[p]=="number"&&(m[p]=t.coords[p]);this.fire("locationfound",m)}},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),U(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(pt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)U(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var i="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),s=R("div",i,e||this._mapPane);return t&&(this._panes[t]=s),s},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new rt(e,i)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=j(t),i=P(i||[0,0]);var s=this.getZoom()||0,r=this.getMinZoom(),c=this.getMaxZoom(),h=t.getNorthWest(),m=t.getSouthEast(),p=this.getSize().subtract(i),_=st(this.project(m,s),this.project(h,s)).getSize(),y=x.any3d?this.options.zoomSnap:1,S=p.x/_.x,E=p.y/_.y,nt=e?Math.max(S,E):Math.min(S,E);return s=this.getScaleZoom(nt,s),y&&(s=Math.round(s/(y/100))*(y/100),s=e?Math.ceil(s/y)*y:Math.floor(s/y)*y),Math.max(r,Math.min(c,s))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new T(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new H(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===void 0?this.getZoom():t)},getPane:function(t){return typeof t=="string"?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=e===void 0?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=e===void 0?this._zoom:e;var s=i.zoom(t*i.scale(e));return isNaN(s)?1/0:s},project:function(t,e){return e=e===void 0?this._zoom:e,this.options.crs.latLngToPoint(O(t),e)},unproject:function(t,e){return e=e===void 0?this._zoom:e,this.options.crs.pointToLatLng(P(t),e)},layerPointToLatLng:function(t){var e=P(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(O(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(O(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(j(t))},distance:function(t,e){return this.options.crs.distance(O(t),O(e))},containerPointToLayerPoint:function(t){return P(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return P(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(P(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(O(t)))},mouseEventToContainerPoint:function(t){return io(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=Xn(t);if(e){if(e._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");k(e,"scroll",this._onScroll,this),this._containerId=v(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&x.any3d,C(t,"leaflet-container"+(x.touch?" leaflet-touch":"")+(x.retina?" leaflet-retina":"")+(x.ielt9?" leaflet-oldie":"")+(x.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=Pe(t,"position");e!=="absolute"&&e!=="relative"&&e!=="fixed"&&e!=="sticky"&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),$(this._mapPane,new T(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(C(t.markerPane,"leaflet-zoom-hide"),C(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,i){$(this._mapPane,new T(0,0));var s=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var r=this._zoom!==e;this._moveStart(r,i)._move(t,e)._moveEnd(r),this.fire("viewreset"),s&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,i,s){e===void 0&&(e=this._zoom);var r=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),s?i&&i.pinch&&this.fire("zoom",i):((r||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return pt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){$(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[v(this._container)]=this;var e=t?Z:k;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),x.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){pt(this._resizeRequest),this._resizeRequest=ot(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i=[],s,r=e==="mouseout"||e==="mouseover",c=t.target||t.srcElement,h=!1;c;){if(s=this._targets[v(c)],s&&(e==="click"||e==="preclick")&&this._draggableMoved(s)){h=!0;break}if(s&&s.listens(e,!0)&&(r&&!Zi(c,t)||(i.push(s),r))||c===this._container)break;c=c.parentNode}return!i.length&&!h&&!r&&this.listens(e,!0)&&(i=[this]),i},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||t.type==="click"&&this._isClickDisabled(e))){var i=t.type;i==="mousedown"&&Bi(e),this._fireDOMEvent(t,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,i){if(t.type==="click"){var s=l({},t);s.type="preclick",this._fireDOMEvent(s,s.type,i)}var r=this._findEventTargets(t,e);if(i){for(var c=[],h=0;h<i.length;h++)i[h].listens(e,!0)&&c.push(i[h]);r=c.concat(r)}if(r.length){e==="contextmenu"&&Q(t);var m=r[0],p={originalEvent:t};if(t.type!=="keypress"&&t.type!=="keydown"&&t.type!=="keyup"){var _=m.getLatLng&&(!m._radius||m._radius<=10);p.containerPoint=_?this.latLngToContainerPoint(m.getLatLng()):this.mouseEventToContainerPoint(t),p.layerPoint=this.containerPointToLayerPoint(p.containerPoint),p.latlng=_?m.getLatLng():this.layerPointToLatLng(p.layerPoint)}for(h=0;h<r.length;h++)if(r[h].fire(e,p,!0),p.originalEvent._stopped||r[h].options.bubblingMouseEvents===!1&&mi(this._mouseEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return ne(this._mapPane)||new T(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var i=t&&e!==void 0?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return i.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var s=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(s)},_latLngBoundsToNewLayerBounds:function(t,e,i){var s=this._getNewPixelOrigin(i,e);return st([this.project(t.getSouthWest(),e)._subtract(s),this.project(t.getNorthWest(),e)._subtract(s),this.project(t.getSouthEast(),e)._subtract(s),this.project(t.getNorthEast(),e)._subtract(s)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var s=this.project(t,e),r=this.getSize().divideBy(2),c=new H(s.subtract(r),s.add(r)),h=this._getBoundsOffset(c,i,e);return Math.abs(h.x)<=1&&Math.abs(h.y)<=1?t:this.unproject(s.add(h),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),s=new H(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(s,e))},_getBoundsOffset:function(t,e,i){var s=st(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),r=s.min.subtract(t.min),c=s.max.subtract(t.max),h=this._rebound(r.x,-c.x),m=this._rebound(r.y,-c.y);return new T(h,m)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),s=x.any3d?this.options.zoomSnap:1;return s&&(t=Math.round(t/s)*s),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){G(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._trunc();return(e&&e.animate)!==!0&&!this.getSize().contains(i)?!1:(this.panBy(i,e),!0)},_createAnimProxy:function(){var t=this._proxy=R("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var i=Ti,s=this._proxy.style[i];ie(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),s===this._proxy.style[i]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){U(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();ie(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var s=this.getZoomScale(e),r=this._getCenterOffset(t)._divideBy(1-1/s);return i.animate!==!0&&!this.getSize().contains(r)?!1:(ot(function(){this._moveStart(!0,i.noMoveStart||!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,i,s){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,C(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:s}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(g(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&G(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function mr(t,e){return new D(t,e)}var St=Ot.extend({options:{position:"topright"},initialize:function(t){F(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),s=t._controlCorners[i];return C(e,"leaflet-control"),i.indexOf("bottom")!==-1?s.insertBefore(e,s.firstChild):s.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(U(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),Me=function(t){return new St(t)};D.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",i=this._controlContainer=R("div",e+"control-container",this._container);function s(r,c){var h=e+r+" "+e+c;t[r+c]=R("div",h,i)}s("top","left"),s("top","right"),s("bottom","left"),s("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)U(this._controlCorners[t]);U(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var so=St.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,s){return i<s?-1:s<i?1:0}},initialize:function(t,e,i){F(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var s in t)this._addLayer(t[s],s);for(s in e)this._addLayer(e[s],s,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return St.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(v(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){C(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(C(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):G(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return G(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=R("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),Ee(e),Ni(e);var s=this._section=R("section",t+"-list");i&&(this._map.on("click",this.collapse,this),k(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var r=this._layersLink=R("a",t+"-toggle",e);r.href="#",r.title="Layers",r.setAttribute("role","button"),k(r,{keydown:function(c){c.keyCode===13&&this._expandSafely()},click:function(c){Q(c),this._expandSafely()}},this),i||this.expand(),this._baseLayersList=R("div",t+"-base",s),this._separator=R("div",t+"-separator",s),this._overlaysList=R("div",t+"-overlays",s),e.appendChild(s)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&v(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(g(function(s,r){return this.options.sortFunction(s.layer,r.layer,s.name,r.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ge(this._baseLayersList),Ge(this._overlaysList),this._layerControlInputs=[];var t,e,i,s,r=0;for(i=0;i<this._layers.length;i++)s=this._layers[i],this._addItem(s),e=e||s.overlay,t=t||!s.overlay,r+=s.overlay?0:1;return this.options.hideSingleBase&&(t=t&&r>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(v(t.target)),i=e.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",s=document.createElement("div");return s.innerHTML=i,s.firstChild},_addItem:function(t){var e=document.createElement("label"),i=this._map.hasLayer(t.layer),s;t.overlay?(s=document.createElement("input"),s.type="checkbox",s.className="leaflet-control-layers-selector",s.defaultChecked=i):s=this._createRadioElement("leaflet-base-layers_"+v(this),i),this._layerControlInputs.push(s),s.layerId=v(t.layer),k(s,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+t.name;var c=document.createElement("span");e.appendChild(c),c.appendChild(s),c.appendChild(r);var h=t.overlay?this._overlaysList:this._baseLayersList;return h.appendChild(e),this._checkDisabledLayers(),e},_onInputClick:function(){if(!this._preventClick){var t=this._layerControlInputs,e,i,s=[],r=[];this._handlingClick=!0;for(var c=t.length-1;c>=0;c--)e=t[c],i=this._getLayer(e.layerId).layer,e.checked?s.push(i):e.checked||r.push(i);for(c=0;c<r.length;c++)this._map.hasLayer(r[c])&&this._map.removeLayer(r[c]);for(c=0;c<s.length;c++)this._map.hasLayer(s[c])||this._map.addLayer(s[c]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t=this._layerControlInputs,e,i,s=this._map.getZoom(),r=t.length-1;r>=0;r--)e=t[r],i=this._getLayer(e.layerId).layer,e.disabled=i.options.minZoom!==void 0&&s<i.options.minZoom||i.options.maxZoom!==void 0&&s>i.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,k(t,"click",Q),this.expand();var e=this;setTimeout(function(){Z(t,"click",Q),e._preventClick=!1})}}),pr=function(t,e,i){return new so(t,e,i)},Fi=St.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=R("div",e+" leaflet-bar"),s=this.options;return this._zoomInButton=this._createButton(s.zoomInText,s.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(s.zoomOutText,s.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,s,r){var c=R("a",i,s);return c.innerHTML=t,c.href="#",c.title=e,c.setAttribute("role","button"),c.setAttribute("aria-label",e),Ee(c),k(c,"click",se),k(c,"click",r,this),k(c,"click",this._refocusOnMap,this),c},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";G(this._zoomInButton,e),G(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(C(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(C(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});D.mergeOptions({zoomControl:!0}),D.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Fi,this.addControl(this.zoomControl))});var gr=function(t){return new Fi(t)},ro=St.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=R("div",e),s=this.options;return this._addScales(s,e+"-line",i),t.on(s.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=R("div",e,i)),t.imperial&&(this._iScale=R("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e=t*3.2808399,i,s,r;e>5280?(i=e/5280,s=this._getRoundNum(i),this._updateScale(this._iScale,s+" mi",s/i)):(r=this._getRoundNum(e),this._updateScale(this._iScale,r+" ft",r/e))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),_r=function(t){return new ro(t)},vr='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Hi=St.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(x.inlineSvg?vr+" ":"")+"Leaflet</a>"},initialize:function(t){F(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=R("div","leaflet-control-attribution"),Ee(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(' <span aria-hidden="true">|</span> ')}}});D.mergeOptions({attributionControl:!0}),D.addInitHook(function(){this.options.attributionControl&&new Hi().addTo(this)});var yr=function(t){return new Hi(t)};St.Layers=so,St.Zoom=Fi,St.Scale=ro,St.Attribution=Hi,Me.layers=pr,Me.zoom=gr,Me.scale=_r,Me.attribution=yr;var At=Ot.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});At.addTo=function(t,e){return t.addHandler(e,this),this};var wr={Events:dt},ao=x.touch?"touchstart mousedown":"mousedown",Gt=be.extend({options:{clickTolerance:3},initialize:function(t,e,i,s){F(this,s),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(k(this._dragStartTarget,ao,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Gt._dragging===this&&this.finishDrag(!0),Z(this._dragStartTarget,ao,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!ki(this._element,"leaflet-zoom-anim"))){if(t.touches&&t.touches.length!==1){Gt._dragging===this&&this.finishDrag();return}if(!(Gt._dragging||t.shiftKey||t.which!==1&&t.button!==1&&!t.touches)&&(Gt._dragging=this,this._preventOutline&&Bi(this._element),Mi(),Te(),!this._moving)){this.fire("down");var e=t.touches?t.touches[0]:t,i=Qn(this._element);this._startPoint=new T(e.clientX,e.clientY),this._startPos=ne(this._element),this._parentScale=zi(i);var s=t.type==="mousedown";k(document,s?"mousemove":"touchmove",this._onMove,this),k(document,s?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(t){if(this._enabled){if(t.touches&&t.touches.length>1){this._moved=!0;return}var e=t.touches&&t.touches.length===1?t.touches[0]:t,i=new T(e.clientX,e.clientY)._subtract(this._startPoint);!i.x&&!i.y||Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,Q(t),this._moved||(this.fire("dragstart"),this._moved=!0,C(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),C(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,this._lastEvent=t,this._updatePosition())}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),$(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){G(document.body,"leaflet-dragging"),this._lastTarget&&(G(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Z(document,"mousemove touchmove",this._onMove,this),Z(document,"mouseup touchend touchcancel",this._onUp,this),Ai(),ke();var e=this._moved&&this._moving;this._moving=!1,Gt._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function lo(t,e,i){var s,r=[1,4,2,8],c,h,m,p,_,y,S,E;for(c=0,y=t.length;c<y;c++)t[c]._code=re(t[c],e);for(m=0;m<4;m++){for(S=r[m],s=[],c=0,y=t.length,h=y-1;c<y;h=c++)p=t[c],_=t[h],p._code&S?_._code&S||(E=Ye(_,p,S,e,i),E._code=re(E,e),s.push(E)):(_._code&S&&(E=Ye(_,p,S,e,i),E._code=re(E,e),s.push(E)),s.push(p));t=s}return t}function co(t,e){var i,s,r,c,h,m,p,_,y;if(!t||t.length===0)throw new Error("latlngs not passed");_t(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var S=O([0,0]),E=j(t),nt=E.getNorthWest().distanceTo(E.getSouthWest())*E.getNorthEast().distanceTo(E.getNorthWest());nt<1700&&(S=Ui(t));var J=t.length,vt=[];for(i=0;i<J;i++){var at=O(t[i]);vt.push(e.project(O([at.lat-S.lat,at.lng-S.lng])))}for(m=p=_=0,i=0,s=J-1;i<J;s=i++)r=vt[i],c=vt[s],h=r.y*c.x-c.y*r.x,p+=(r.x+c.x)*h,_+=(r.y+c.y)*h,m+=h*3;m===0?y=vt[0]:y=[p/m,_/m];var ve=e.unproject(P(y));return O([ve.lat+S.lat,ve.lng+S.lng])}function Ui(t){for(var e=0,i=0,s=0,r=0;r<t.length;r++){var c=O(t[r]);e+=c.lat,i+=c.lng,s++}return O([e/s,i/s])}var br={__proto__:null,clipPolygon:lo,polygonCenter:co,centroid:Ui};function ho(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=Sr(t,i),t=xr(t,i),t}function uo(t,e,i){return Math.sqrt(Ae(t,e,i,!0))}function Lr(t,e,i){return Ae(t,e,i)}function xr(t,e){var i=t.length,s=typeof Uint8Array<"u"?Uint8Array:Array,r=new s(i);r[0]=r[i-1]=1,qi(t,r,e,0,i-1);var c,h=[];for(c=0;c<i;c++)r[c]&&h.push(t[c]);return h}function qi(t,e,i,s,r){var c=0,h,m,p;for(m=s+1;m<=r-1;m++)p=Ae(t[m],t[s],t[r],!0),p>c&&(h=m,c=p);c>i&&(e[h]=1,qi(t,e,i,s,h),qi(t,e,i,h,r))}function Sr(t,e){for(var i=[t[0]],s=1,r=0,c=t.length;s<c;s++)Pr(t[s],t[r])>e&&(i.push(t[s]),r=s);return r<c-1&&i.push(t[c-1]),i}var fo;function mo(t,e,i,s,r){var c=s?fo:re(t,i),h=re(e,i),m,p,_;for(fo=h;;){if(!(c|h))return[t,e];if(c&h)return!1;m=c||h,p=Ye(t,e,m,i,r),_=re(p,i),m===c?(t=p,c=_):(e=p,h=_)}}function Ye(t,e,i,s,r){var c=e.x-t.x,h=e.y-t.y,m=s.min,p=s.max,_,y;return i&8?(_=t.x+c*(p.y-t.y)/h,y=p.y):i&4?(_=t.x+c*(m.y-t.y)/h,y=m.y):i&2?(_=p.x,y=t.y+h*(p.x-t.x)/c):i&1&&(_=m.x,y=t.y+h*(m.x-t.x)/c),new T(_,y,r)}function re(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function Pr(t,e){var i=e.x-t.x,s=e.y-t.y;return i*i+s*s}function Ae(t,e,i,s){var r=e.x,c=e.y,h=i.x-r,m=i.y-c,p=h*h+m*m,_;return p>0&&(_=((t.x-r)*h+(t.y-c)*m)/p,_>1?(r=i.x,c=i.y):_>0&&(r+=h*_,c+=m*_)),h=t.x-r,m=t.y-c,s?h*h+m*m:new T(r,c)}function _t(t){return!xt(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]<"u"}function po(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),_t(t)}function go(t,e){var i,s,r,c,h,m,p,_;if(!t||t.length===0)throw new Error("latlngs not passed");_t(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var y=O([0,0]),S=j(t),E=S.getNorthWest().distanceTo(S.getSouthWest())*S.getNorthEast().distanceTo(S.getNorthWest());E<1700&&(y=Ui(t));var nt=t.length,J=[];for(i=0;i<nt;i++){var vt=O(t[i]);J.push(e.project(O([vt.lat-y.lat,vt.lng-y.lng])))}for(i=0,s=0;i<nt-1;i++)s+=J[i].distanceTo(J[i+1])/2;if(s===0)_=J[0];else for(i=0,c=0;i<nt-1;i++)if(h=J[i],m=J[i+1],r=h.distanceTo(m),c+=r,c>s){p=(c-s)/r,_=[m.x-p*(m.x-h.x),m.y-p*(m.y-h.y)];break}var at=e.unproject(P(_));return O([at.lat+y.lat,at.lng+y.lng])}var Tr={__proto__:null,simplify:ho,pointToSegmentDistance:uo,closestPointOnSegment:Lr,clipSegment:mo,_getEdgeIntersection:Ye,_getBitCode:re,_sqClosestPointOnSegment:Ae,isFlat:_t,_flat:po,polylineCenter:go},Wi={project:function(t){return new T(t.lng,t.lat)},unproject:function(t){return new N(t.y,t.x)},bounds:new H([-180,-90],[180,90])},Gi={R:6378137,R_MINOR:6356752314245179e-9,bounds:new H([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(t){var e=Math.PI/180,i=this.R,s=t.lat*e,r=this.R_MINOR/i,c=Math.sqrt(1-r*r),h=c*Math.sin(s),m=Math.tan(Math.PI/4-s/2)/Math.pow((1-h)/(1+h),c/2);return s=-i*Math.log(Math.max(m,1e-10)),new T(t.lng*e*i,s)},unproject:function(t){for(var e=180/Math.PI,i=this.R,s=this.R_MINOR/i,r=Math.sqrt(1-s*s),c=Math.exp(-t.y/i),h=Math.PI/2-2*Math.atan(c),m=0,p=.1,_;m<15&&Math.abs(p)>1e-7;m++)_=r*Math.sin(h),_=Math.pow((1-_)/(1+_),r/2),p=Math.PI/2-2*Math.atan(c*_)-h,h+=p;return new N(h*e,t.x*e/i)}},kr={__proto__:null,LonLat:Wi,Mercator:Gi,SphericalMercator:_i},Cr=l({},Wt,{code:"EPSG:3395",projection:Gi,transformation:function(){var t=.5/(Math.PI*Gi.R);return Le(t,.5,-t,.5)}()}),_o=l({},Wt,{code:"EPSG:4326",projection:Wi,transformation:Le(1/180,1,-1/180,.5)}),Er=l({},Dt,{projection:Wi,transformation:Le(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,s=e.lat-t.lat;return Math.sqrt(i*i+s*s)},infinite:!0});Dt.Earth=Wt,Dt.EPSG3395=Cr,Dt.EPSG3857=yi,Dt.EPSG900913=Os,Dt.EPSG4326=_o,Dt.Simple=Er;var Pt=be.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[v(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[v(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});D.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=v(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=v(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return v(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){t=t?xt(t)?t:[t]:[];for(var e=0,i=t.length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){(!isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[v(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=v(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,i=this._getZoomSpan();for(var s in this._zoomBoundLayers){var r=this._zoomBoundLayers[s].options;t=r.minZoom===void 0?t:Math.min(t,r.minZoom),e=r.maxZoom===void 0?e:Math.max(e,r.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var fe=Pt.extend({initialize:function(t,e){F(this,e),this._layers={};var i,s;if(t)for(i=0,s=t.length;i<s;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){var e=typeof t=="number"?t:this.getLayerId(t);return e in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e=Array.prototype.slice.call(arguments,1),i,s;for(i in this._layers)s=this._layers[i],s[t]&&s[t].apply(s,e);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return v(t)}}),Mr=function(t,e){return new fe(t,e)},Rt=fe.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),fe.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),fe.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new rt;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),Ar=function(t,e){return new Rt(t,e)},me=Ot.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){F(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if(t==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var s=this._createImg(i,e&&e.tagName==="IMG"?e:null);return this._setIconStyles(s,t),(this.options.crossOrigin||this.options.crossOrigin==="")&&(s.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),s},_setIconStyles:function(t,e){var i=this.options,s=i[e+"Size"];typeof s=="number"&&(s=[s,s]);var r=P(s),c=P(e==="shadow"&&i.shadowAnchor||i.iconAnchor||r&&r.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),c&&(t.style.marginLeft=-c.x+"px",t.style.marginTop=-c.y+"px"),r&&(t.style.width=r.x+"px",t.style.height=r.y+"px")},_createImg:function(t,e){return e=e||document.createElement("img"),e.src=t,e},_getIconUrl:function(t){return x.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Ir(t){return new me(t)}var Ie=me.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return typeof Ie.imagePath!="string"&&(Ie.imagePath=this._detectIconPath()),(this.options.imagePath||Ie.imagePath)+me.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(i,s,r){var c=s.exec(i);return c&&c[r]};return t=e(t,/^url\((['"])?(.+)\1\)$/,2),t&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=R("div","leaflet-default-icon-path",document.body),e=Pe(t,"background-image")||Pe(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e),e)return e;var i=document.querySelector('link[href$="leaflet.css"]');return i?i.href.substring(0,i.href.length-11-1):""}}),vo=At.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new Gt(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),C(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&G(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,s=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,c=ne(e._icon),h=i.getPixelBounds(),m=i.getPixelOrigin(),p=st(h.min._subtract(m).add(r),h.max._subtract(m).subtract(r));if(!p.contains(c)){var _=P((Math.max(p.max.x,c.x)-p.max.x)/(h.max.x-p.max.x)-(Math.min(p.min.x,c.x)-p.min.x)/(h.min.x-p.min.x),(Math.max(p.max.y,c.y)-p.max.y)/(h.max.y-p.max.y)-(Math.min(p.min.y,c.y)-p.min.y)/(h.min.y-p.min.y)).multiplyBy(s);i.panBy(_,{animate:!1}),this._draggable._newPos._add(_),this._draggable._startPos._add(_),$(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=ot(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(pt(this._panRequest),this._panRequest=ot(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,s=ne(e._icon),r=e._map.layerPointToLatLng(s);i&&$(i,s),e._latlng=r,t.latlng=r,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){pt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Je=Pt.extend({options:{icon:new Ie,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){F(this,e),this._latlng=O(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=O(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),s=!1;i!==this._icon&&(this._icon&&this._removeIcon(),s=!0,t.title&&(i.title=t.title),i.tagName==="IMG"&&(i.alt=t.alt||"")),C(i,e),t.keyboard&&(i.tabIndex="0",i.setAttribute("role","button")),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&k(i,"focus",this._panOnFocus,this);var r=t.icon.createShadow(this._shadow),c=!1;r!==this._shadow&&(this._removeShadow(),c=!0),r&&(C(r,e),r.alt=""),this._shadow=r,t.opacity<1&&this._updateOpacity(),s&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&c&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Z(this._icon,"focus",this._panOnFocus,this),U(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&U(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&$(this._icon,t),this._shadow&&$(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(C(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),vo)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new vo(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&gt(this._icon,t),this._shadow&&gt(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,i=e.iconSize?P(e.iconSize):P(0,0),s=e.iconAnchor?P(e.iconAnchor):P(0,0);t.panInside(this._latlng,{paddingTopLeft:s,paddingBottomRight:i.subtract(s)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Br(t,e){return new Je(t,e)}var Vt=Pt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return F(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Xe=Vt.extend({options:{fill:!0,radius:10},initialize:function(t,e){F(this,e),this._latlng=O(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=O(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Vt.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),s=[t+i,e+i];this._pxBounds=new H(this._point.subtract(s),this._point.add(s))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function zr(t,e){return new Xe(t,e)}var Vi=Xe.extend({initialize:function(t,e,i){if(typeof e=="number"&&(e=l({},i,{radius:e})),F(this,e),this._latlng=O(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new rt(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Vt.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,s=i.options.crs;if(s.distance===Wt.distance){var r=Math.PI/180,c=this._mRadius/Wt.R/r,h=i.project([e+c,t]),m=i.project([e-c,t]),p=h.add(m).divideBy(2),_=i.unproject(p).lat,y=Math.acos((Math.cos(c*r)-Math.sin(e*r)*Math.sin(_*r))/(Math.cos(e*r)*Math.cos(_*r)))/r;(isNaN(y)||y===0)&&(y=c/Math.cos(Math.PI/180*e)),this._point=p.subtract(i.getPixelOrigin()),this._radius=isNaN(y)?0:p.x-i.project([_,t-y]).x,this._radiusY=p.y-h.y}else{var S=s.unproject(s.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(S).x}this._updateBounds()}});function Or(t,e,i){return new Vi(t,e,i)}var Nt=Vt.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){F(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e=1/0,i=null,s=Ae,r,c,h=0,m=this._parts.length;h<m;h++)for(var p=this._parts[h],_=1,y=p.length;_<y;_++){r=p[_-1],c=p[_];var S=s(t,r,c,!0);S<e&&(e=S,i=s(t,r,c))}return i&&(i.distance=Math.sqrt(e)),i},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return go(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=O(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new rt,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return _t(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=_t(t),s=0,r=t.length;s<r;s++)i?(e[s]=O(t[s]),this._bounds.extend(e[s])):e[s]=this._convertLatLngs(t[s]);return e},_project:function(){var t=new H;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new T(t,t);this._rawPxBounds&&(this._pxBounds=new H([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,i){var s=t[0]instanceof N,r=t.length,c,h;if(s){for(h=[],c=0;c<r;c++)h[c]=this._map.latLngToLayerPoint(t[c]),i.extend(h[c]);e.push(h)}else for(c=0;c<r;c++)this._projectLatlngs(t[c],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}var e=this._parts,i,s,r,c,h,m,p;for(i=0,r=0,c=this._rings.length;i<c;i++)for(p=this._rings[i],s=0,h=p.length;s<h-1;s++)m=mo(p[s],p[s+1],t,s,!0),m&&(e[r]=e[r]||[],e[r].push(m[0]),(m[1]!==p[s+1]||s===h-2)&&(e[r].push(m[1]),r++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,s=t.length;i<s;i++)t[i]=ho(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,s,r,c,h,m,p=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,c=this._parts.length;i<c;i++)for(m=this._parts[i],s=0,h=m.length,r=h-1;s<h;r=s++)if(!(!e&&s===0)&&uo(t,m[r],m[s])<=p)return!0;return!1}});function Dr(t,e){return new Nt(t,e)}Nt._flat=po;var pe=Nt.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return co(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=Nt.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof N&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){Nt.prototype._setLatLngs.call(this,t),_t(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return _t(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new T(e,e);if(t=new H(t.min.subtract(i),t.max.add(i)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}for(var s=0,r=this._rings.length,c;s<r;s++)c=lo(this._rings[s],t,!0),c.length&&this._parts.push(c)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e=!1,i,s,r,c,h,m,p,_;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(c=0,p=this._parts.length;c<p;c++)for(i=this._parts[c],h=0,_=i.length,m=_-1;h<_;m=h++)s=i[h],r=i[m],s.y>t.y!=r.y>t.y&&t.x<(r.x-s.x)*(t.y-s.y)/(r.y-s.y)+s.x&&(e=!e);return e||Nt.prototype._containsPoint.call(this,t,!0)}});function Rr(t,e){return new pe(t,e)}var Zt=Rt.extend({initialize:function(t,e){F(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e=xt(t)?t:t.features,i,s,r;if(e){for(i=0,s=e.length;i<s;i++)r=e[i],(r.geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var c=this.options;if(c.filter&&!c.filter(t))return this;var h=Qe(t,c);return h?(h.feature=ii(t),h.defaultOptions=h.options,this.resetStyle(h),c.onEachFeature&&c.onEachFeature(t,h),this.addLayer(h)):this},resetStyle:function(t){return t===void 0?this.eachLayer(this.resetStyle,this):(t.options=l({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&(typeof e=="function"&&(e=e(t.feature)),t.setStyle(e))}});function Qe(t,e){var i=t.type==="Feature"?t.geometry:t,s=i?i.coordinates:null,r=[],c=e&&e.pointToLayer,h=e&&e.coordsToLatLng||ji,m,p,_,y;if(!s&&!i)return null;switch(i.type){case"Point":return m=h(s),yo(c,t,m,e);case"MultiPoint":for(_=0,y=s.length;_<y;_++)m=h(s[_]),r.push(yo(c,t,m,e));return new Rt(r);case"LineString":case"MultiLineString":return p=ti(s,i.type==="LineString"?0:1,h),new Nt(p,e);case"Polygon":case"MultiPolygon":return p=ti(s,i.type==="Polygon"?1:2,h),new pe(p,e);case"GeometryCollection":for(_=0,y=i.geometries.length;_<y;_++){var S=Qe({geometry:i.geometries[_],type:"Feature",properties:t.properties},e);S&&r.push(S)}return new Rt(r);case"FeatureCollection":for(_=0,y=i.features.length;_<y;_++){var E=Qe(i.features[_],e);E&&r.push(E)}return new Rt(r);default:throw new Error("Invalid GeoJSON object.")}}function yo(t,e,i,s){return t?t(e,i):new Je(i,s&&s.markersInheritOptions&&s)}function ji(t){return new N(t[1],t[0],t[2])}function ti(t,e,i){for(var s=[],r=0,c=t.length,h;r<c;r++)h=e?ti(t[r],e-1,i):(i||ji)(t[r]),s.push(h);return s}function $i(t,e){return t=O(t),t.alt!==void 0?[ut(t.lng,e),ut(t.lat,e),ut(t.alt,e)]:[ut(t.lng,e),ut(t.lat,e)]}function ei(t,e,i,s){for(var r=[],c=0,h=t.length;c<h;c++)r.push(e?ei(t[c],_t(t[c])?0:e-1,i,s):$i(t[c],s));return!e&&i&&r.length>0&&r.push(r[0].slice()),r}function ge(t,e){return t.feature?l({},t.feature,{geometry:e}):ii(e)}function ii(t){return t.type==="Feature"||t.type==="FeatureCollection"?t:{type:"Feature",properties:{},geometry:t}}var Ki={toGeoJSON:function(t){return ge(this,{type:"Point",coordinates:$i(this.getLatLng(),t)})}};Je.include(Ki),Vi.include(Ki),Xe.include(Ki),Nt.include({toGeoJSON:function(t){var e=!_t(this._latlngs),i=ei(this._latlngs,e?1:0,!1,t);return ge(this,{type:(e?"Multi":"")+"LineString",coordinates:i})}}),pe.include({toGeoJSON:function(t){var e=!_t(this._latlngs),i=e&&!_t(this._latlngs[0]),s=ei(this._latlngs,i?2:e?1:0,!0,t);return e||(s=[s]),ge(this,{type:(i?"Multi":"")+"Polygon",coordinates:s})}}),fe.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(i){e.push(i.toGeoJSON(t).geometry.coordinates)}),ge(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(e==="MultiPoint")return this.toMultiPoint(t);var i=e==="GeometryCollection",s=[];return this.eachLayer(function(r){if(r.toGeoJSON){var c=r.toGeoJSON(t);if(i)s.push(c.geometry);else{var h=ii(c);h.type==="FeatureCollection"?s.push.apply(s,h.features):s.push(h)}}}),i?ge(this,{geometries:s,type:"GeometryCollection"}):{type:"FeatureCollection",features:s}}});function wo(t,e){return new Zt(t,e)}var Nr=wo,ni=Pt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=j(e),F(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(C(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){U(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&ue(this._image),this},bringToBack:function(){return this._map&&de(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=j(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._url.tagName==="IMG",e=this._image=t?this._url:R("img");if(C(e,"leaflet-image-layer"),this._zoomAnimated&&C(e,"leaflet-zoom-animated"),this.options.className&&C(e,this.options.className),e.onselectstart=B,e.onmousemove=B,e.onload=g(this.fire,this,"load"),e.onerror=g(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(e.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t){this._url=e.src;return}e.src=this._url,e.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;ie(this._image,i,e)},_reset:function(){var t=this._image,e=new H(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();$(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){gt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Zr=function(t,e,i){return new ni(t,e,i)},bo=ni.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t=this._url.tagName==="VIDEO",e=this._image=t?this._url:R("video");if(C(e,"leaflet-image-layer"),this._zoomAnimated&&C(e,"leaflet-zoom-animated"),this.options.className&&C(e,this.options.className),e.onselectstart=B,e.onmousemove=B,e.onloadeddata=g(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),s=[],r=0;r<i.length;r++)s.push(i[r].src);this._url=i.length>0?s:[e.src];return}xt(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var c=0;c<this._url.length;c++){var h=R("source");h.src=this._url[c],e.appendChild(h)}}});function Fr(t,e,i){return new bo(t,e,i)}var Lo=ni.extend({_initImage:function(){var t=this._image=this._url;C(t,"leaflet-image-layer"),this._zoomAnimated&&C(t,"leaflet-zoom-animated"),this.options.className&&C(t,this.options.className),t.onselectstart=B,t.onmousemove=B}});function Hr(t,e,i){return new Lo(t,e,i)}var It=Pt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof N||xt(t))?(this._latlng=O(t),F(this,e)):(F(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return t=arguments.length?t:this._source._map,t.hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&gt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&gt(this._container,1),this.bringToFront(),this.options.interactive&&(C(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(gt(this._container,0),this._removeTimeout=setTimeout(g(U,void 0,this._container),200)):U(this._container),this.options.interactive&&(G(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=O(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ue(this._container),this},bringToBack:function(){return this._map&&de(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof Rt){e=null;var i=this._source._layers;for(var s in i)if(i[s]._map){e=i[s];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else if(e.getBounds)t=e.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof e=="string")t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=P(this.options.offset),i=this._getAnchor();this._zoomAnimated?$(this._container,t.add(i)):e=e.add(t).add(i);var s=this._containerBottom=-e.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=s+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}});D.include({_initOverlay:function(t,e,i,s){var r=e;return r instanceof t||(r=new t(s).setContent(e)),i&&r.setLatLng(i),r}}),Pt.include({_initOverlay:function(t,e,i,s){var r=i;return r instanceof t?(F(r,s),r._source=this):(r=e&&!s?e:new t(s,this),r.setContent(i)),r}});var oi=It.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t=arguments.length?t:this._source._map,!t.hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,It.prototype.openOn.call(this,t)},onAdd:function(t){It.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Vt||this._source.on("preclick",oe))},onRemove:function(t){It.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Vt||this._source.off("preclick",oe))},getEvents:function(){var t=It.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=R("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=R("div",t+"-content-wrapper",e);if(this._contentNode=R("div",t+"-content",i),Ee(e),Ni(this._contentNode),k(e,"contextmenu",oe),this._tipContainer=R("div",t+"-tip-container",e),this._tip=R("div",t+"-tip",this._tipContainer),this.options.closeButton){var s=this._closeButton=R("a",t+"-close-button",e);s.setAttribute("role","button"),s.setAttribute("aria-label","Close popup"),s.href="#close",s.innerHTML='<span aria-hidden="true">&#215;</span>',k(s,"click",function(r){Q(r),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var s=t.offsetHeight,r=this.options.maxHeight,c="leaflet-popup-scrolled";r&&s>r?(e.height=r+"px",C(t,c)):G(t,c),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();$(this._container,e.add(i))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var t=this._map,e=parseInt(Pe(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,s=this._containerWidth,r=new T(this._containerLeft,-i-this._containerBottom);r._add(ne(this._container));var c=t.layerPointToContainerPoint(r),h=P(this.options.autoPanPadding),m=P(this.options.autoPanPaddingTopLeft||h),p=P(this.options.autoPanPaddingBottomRight||h),_=t.getSize(),y=0,S=0;c.x+s+p.x>_.x&&(y=c.x+s-_.x+p.x),c.x-y-m.x<0&&(y=c.x-m.x),c.y+i+p.y>_.y&&(S=c.y+i-_.y+p.y),c.y-S-m.y<0&&(S=c.y-m.y),(y||S)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([y,S]))}},_getAnchor:function(){return P(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ur=function(t,e){return new oi(t,e)};D.mergeOptions({closePopupOnClick:!0}),D.include({openPopup:function(t,e,i){return this._initOverlay(oi,t,e,i).openOn(this),this},closePopup:function(t){return t=arguments.length?t:this._popup,t&&t.close(),this}}),Pt.include({bindPopup:function(t,e){return this._popup=this._initOverlay(oi,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Rt||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(!(!this._popup||!this._map)){se(t);var e=t.layer||t.target;if(this._popup._source===e&&!(e instanceof Vt)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng);return}this._popup._source=e,this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){t.originalEvent.keyCode===13&&this._openPopup(t)}});var si=It.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){It.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){It.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=It.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=R("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+v(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,i,s=this._map,r=this._container,c=s.latLngToContainerPoint(s.getCenter()),h=s.layerPointToContainerPoint(t),m=this.options.direction,p=r.offsetWidth,_=r.offsetHeight,y=P(this.options.offset),S=this._getAnchor();m==="top"?(e=p/2,i=_):m==="bottom"?(e=p/2,i=0):m==="center"?(e=p/2,i=_/2):m==="right"?(e=0,i=_/2):m==="left"?(e=p,i=_/2):h.x<c.x?(m="right",e=0,i=_/2):(m="left",e=p+(y.x+S.x)*2,i=_/2),t=t.subtract(P(e,i,!0)).add(y).add(S),G(r,"leaflet-tooltip-right"),G(r,"leaflet-tooltip-left"),G(r,"leaflet-tooltip-top"),G(r,"leaflet-tooltip-bottom"),C(r,"leaflet-tooltip-"+m),$(r,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&gt(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return P(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),qr=function(t,e){return new si(t,e)};D.include({openTooltip:function(t,e,i){return this._initOverlay(si,t,e,i).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Pt.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(si,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(!(!t&&this._tooltipHandlersAdded)){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,i.click=this._openTooltip,this._map?this._addFocusListeners():i.add=this._addFocusListeners),this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Rt||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e=typeof t.getElement=="function"&&t.getElement();e&&(k(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),k(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e=typeof t.getElement=="function"&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)});return}this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)}},_moveTooltip:function(t){var e=t.latlng,i,s;this._tooltip.options.sticky&&t.originalEvent&&(i=this._map.mouseEventToContainerPoint(t.originalEvent),s=this._map.containerPointToLayerPoint(i),e=this._map.layerPointToLatLng(s)),this._tooltip.setLatLng(e)}});var xo=me.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&t.tagName==="DIV"?t:document.createElement("div"),i=this.options;if(i.html instanceof Element?(Ge(e),e.appendChild(i.html)):e.innerHTML=i.html!==!1?i.html:"",i.bgPos){var s=P(i.bgPos);e.style.backgroundPosition=-s.x+"px "+-s.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});function Wr(t){return new xo(t)}me.Default=Ie;var Be=Pt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:x.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){F(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),U(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ue(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(de(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=A(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof T?t:new T(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e=this.getPane().children,i=-t(-1/0,1/0),s=0,r=e.length,c;s<r;s++)c=e[s].style.zIndex,e[s]!==this._container&&c&&(i=t(i,+c));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!x.ielt9){gt(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var s in this._tiles){var r=this._tiles[s];if(!(!r.current||!r.loaded)){var c=Math.min(1,(t-r.loaded)/200);gt(r.el,c),c<1?e=!0:(r.active?i=!0:this._onOpaqueTile(r),r.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(pt(this._fadeFrame),this._fadeFrame=ot(this._updateOpacity,this))}},_onOpaqueTile:B,_initContainer:function(){this._container||(this._container=R("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t!==void 0){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(U(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var s=this._levels[t],r=this._map;return s||(s=this._levels[t]={},s.el=R("div","leaflet-tile-container leaflet-zoom-animated",this._container),s.el.style.zIndex=e,s.origin=r.project(r.unproject(r.getPixelOrigin()),t).round(),s.zoom=t,this._setZoomTransform(s,r.getCenter(),r.getZoom()),B(s.el.offsetWidth),this._onCreateLevel(s)),this._level=s,s}},_onUpdateLevel:B,_onRemoveLevel:B,_onCreateLevel:B,_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom){this._removeAllTiles();return}for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var s=e.coords;this._retainParent(s.x,s.y,s.z,s.z-5)||this._retainChildren(s.x,s.y,s.z,s.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)U(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,s){var r=Math.floor(t/2),c=Math.floor(e/2),h=i-1,m=new T(+r,+c);m.z=+h;var p=this._tileCoordsToKey(m),_=this._tiles[p];return _&&_.active?(_.retain=!0,!0):(_&&_.loaded&&(_.retain=!0),h>s?this._retainParent(r,c,h,s):!1)},_retainChildren:function(t,e,i,s){for(var r=2*t;r<2*t+2;r++)for(var c=2*e;c<2*e+2;c++){var h=new T(r,c);h.z=i+1;var m=this._tileCoordsToKey(h),p=this._tiles[m];if(p&&p.active){p.retain=!0;continue}else p&&p.loaded&&(p.retain=!0);i+1<s&&this._retainChildren(r,c,i+1,s)}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return e.minNativeZoom!==void 0&&t<e.minNativeZoom?e.minNativeZoom:e.maxNativeZoom!==void 0&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,s){var r=Math.round(e);this.options.maxZoom!==void 0&&r>this.options.maxZoom||this.options.minZoom!==void 0&&r<this.options.minZoom?r=void 0:r=this._clampZoom(r);var c=this.options.updateWhenZooming&&r!==this._tileZoom;(!s||c)&&(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),r!==void 0&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var s=this._map.getZoomScale(i,t.zoom),r=t.origin.multiplyBy(s).subtract(this._map._getNewPixelOrigin(e,i)).round();x.any3d?ie(t.el,r,s):$(t.el,r)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),s=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],s).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],s).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],s).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],s).y/i.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),s=e.getZoomScale(i,this._tileZoom),r=e.project(t,this._tileZoom).floor(),c=e.getSize().divideBy(s*2);return new H(r.subtract(c),r.add(c))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(t===void 0&&(t=e.getCenter()),this._tileZoom!==void 0){var s=this._getTiledPixelBounds(t),r=this._pxBoundsToTileRange(s),c=r.getCenter(),h=[],m=this.options.keepBuffer,p=new H(r.getBottomLeft().subtract([m,-m]),r.getTopRight().add([m,-m]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var _ in this._tiles){var y=this._tiles[_].coords;(y.z!==this._tileZoom||!p.contains(new T(y.x,y.y)))&&(this._tiles[_].current=!1)}if(Math.abs(i-this._tileZoom)>1){this._setView(t,i);return}for(var S=r.min.y;S<=r.max.y;S++)for(var E=r.min.x;E<=r.max.x;E++){var nt=new T(E,S);if(nt.z=this._tileZoom,!!this._isValidTile(nt)){var J=this._tiles[this._tileCoordsToKey(nt)];J?J.current=!0:h.push(nt)}}if(h.sort(function(at,ve){return at.distanceTo(c)-ve.distanceTo(c)}),h.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var vt=document.createDocumentFragment();for(E=0;E<h.length;E++)this._addTile(h[E],vt);this._level.el.appendChild(vt)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var s=this._tileCoordsToBounds(t);return j(this.options.bounds).overlaps(s)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),s=t.scaleBy(i),r=s.add(i),c=e.unproject(s,t.z),h=e.unproject(r,t.z);return[c,h]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),i=new rt(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new T(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(U(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){C(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=B,t.onmousemove=B,x.ielt9&&this.options.opacity<1&&gt(t,this.options.opacity)},_addTile:function(t,e){var i=this._getTilePos(t),s=this._tileCoordsToKey(t),r=this.createTile(this._wrapCoords(t),g(this._tileReady,this,t));this._initTile(r),this.createTile.length<2&&ot(g(this._tileReady,this,t,null,r)),$(r,i),this._tiles[s]={el:r,coords:t,current:!0},e.appendChild(r),this.fire("tileloadstart",{tile:r,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var s=this._tileCoordsToKey(t);i=this._tiles[s],i&&(i.loaded=+new Date,this._map._fadeAnimated?(gt(i.el,0),pt(this._fadeFrame),this._fadeFrame=ot(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(C(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),x.ielt9||!this._map._fadeAnimated?ot(this._pruneTiles,this):setTimeout(g(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new T(this._wrapX?W(t.x,this._wrapX):t.x,this._wrapY?W(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new H(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function Gr(t){return new Be(t)}var _e=Be.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,e=F(this,e),e.detectRetina&&x.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),typeof e.subdomains=="string"&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&e===void 0&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return k(i,"load",g(this._tileOnLoad,this,e,i)),k(i,"error",g(this._tileOnError,this,e,i)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(i.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(i.referrerPolicy=this.options.referrerPolicy),i.alt="",i.src=this.getTileUrl(t),i},getTileUrl:function(t){var e={r:x.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}return Sn(this._url,l(e,this.options))},_tileOnLoad:function(t,e){x.ielt9?setTimeout(g(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var s=this.options.errorTileUrl;s&&e.getAttribute("src")!==s&&(e.src=s),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,i=this.options.zoomReverse,s=this.options.zoomOffset;return i&&(t=e-t),t+s},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=B,e.onerror=B,!e.complete)){e.src=Ue;var i=this._tiles[t].coords;U(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:i})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",Ue),Be.prototype._removeTile.call(this,t)},_tileReady:function(t,e,i){if(!(!this._map||i&&i.getAttribute("src")===Ue))return Be.prototype._tileReady.call(this,t,e,i)}});function So(t,e){return new _e(t,e)}var Po=_e.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i=l({},this.defaultWmsParams);for(var s in e)s in this.options||(i[s]=e[s]);e=F(this,e);var r=e.detectRetina&&x.retina?2:1,c=this.getTileSize();i.width=c.x*r,i.height=c.y*r,this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,_e.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,s=st(i.project(e[0]),i.project(e[1])),r=s.min,c=s.max,h=(this._wmsVersion>=1.3&&this._crs===_o?[r.y,r.x,c.y,c.x]:[r.x,r.y,c.x,c.y]).join(","),m=_e.prototype.getTileUrl.call(this,t);return m+xn(this.wmsParams,m,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},setParams:function(t,e){return l(this.wmsParams,t),e||this.redraw(),this}});function Vr(t,e){return new Po(t,e)}_e.WMS=Po,So.wms=Vr;var Ft=Pt.extend({options:{padding:.1},initialize:function(t){F(this,t),v(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),C(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),s=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),c=s.multiplyBy(-i).add(r).subtract(this._map._getNewPixelOrigin(t,e));x.any3d?ie(this._container,c,i):$(this._container,c)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new H(i,i.add(e.multiplyBy(1+t*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),To=Ft.extend({options:{tolerance:0},getEvents:function(){var t=Ft.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ft.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");k(t,"mousemove",this._onMouseMove,this),k(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),k(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){pt(this._redrawRequest),delete this._ctx,U(this._container),Z(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ft.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),s=x.retina?2:1;$(e,t.min),e.width=s*i.x,e.height=s*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",x.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Ft.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[v(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,s=e.prev;i?i.prev=s:this._drawLast=s,s?s.next=i:this._drawFirst=i,delete t._order,delete this._layers[v(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(typeof t.options.dashArray=="string"){var e=t.options.dashArray.split(/[, ]+/),i=[],s,r;for(r=0;r<e.length;r++){if(s=Number(e[r]),isNaN(s))return;i.push(s)}t.options._dashArray=i}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||ot(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new H,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var s=this._drawFirst;s;s=s.next)t=s.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,s,r,c,h=t._parts,m=h.length,p=this._ctx;if(m){for(p.beginPath(),i=0;i<m;i++){for(s=0,r=h[i].length;s<r;s++)c=h[i][s],p[s?"lineTo":"moveTo"](c.x,c.y);e&&p.closePath()}this._fillStroke(p,t)}}},_updateCircle:function(t){if(!(!this._drawing||t._empty())){var e=t._point,i=this._ctx,s=Math.max(Math.round(t._radius),1),r=(Math.max(Math.round(t._radiusY),1)||s)/s;r!==1&&(i.save(),i.scale(1,r)),i.beginPath(),i.arc(e.x,e.y/r,s,0,Math.PI*2,!1),r!==1&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&i.weight!==0&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e=this._map.mouseEventToLayerPoint(t),i,s,r=this._drawFirst;r;r=r.next)i=r.layer,i.options.interactive&&i._containsPoint(e)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(i))&&(s=i);this._fireEvent(s?[s]:!1,t)},_onMouseMove:function(t){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(G(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var i,s,r=this._drawFirst;r;r=r.next)i=r.layer,i.options.interactive&&i._containsPoint(e)&&(s=i);s!==this._hoveredLayer&&(this._handleMouseOut(t),s&&(C(this._container,"leaflet-interactive"),this._fireEvent([s],t,"mouseover"),this._hoveredLayer=s)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,t),this._mouseHoverThrottled=!0,setTimeout(g(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var i=e.next,s=e.prev;if(i)i.prev=s;else return;s?s.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t)}},_bringToBack:function(t){var e=t._order;if(e){var i=e.next,s=e.prev;if(s)s.next=i;else return;i?i.prev=s:s&&(this._drawLast=s),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t)}}});function ko(t){return x.canvas?new To(t):null}var ze=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch{}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),jr={_initContainer:function(){this._container=R("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ft.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=ze("shape");C(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=ze("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[v(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;U(e),t.removeInteractiveTarget(e),delete this._layers[v(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,s=t.options,r=t._container;r.stroked=!!s.stroke,r.filled=!!s.fill,s.stroke?(e||(e=t._stroke=ze("stroke")),r.appendChild(e),e.weight=s.weight+"px",e.color=s.color,e.opacity=s.opacity,s.dashArray?e.dashStyle=xt(s.dashArray)?s.dashArray.join(" "):s.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=s.lineCap.replace("butt","flat"),e.joinstyle=s.lineJoin):e&&(r.removeChild(e),t._stroke=null),s.fill?(i||(i=t._fill=ze("fill")),r.appendChild(i),i.color=s.fillColor||s.color,i.opacity=s.fillOpacity):i&&(r.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),s=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+s+" 0,"+65535*360)},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){ue(t._container)},_bringToBack:function(t){de(t._container)}},ri=x.vml?ze:Mn,Oe=Ft.extend({_initContainer:function(){this._container=ri("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ri("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){U(this._container),Z(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ft.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;(!this._svgSize||!this._svgSize.equals(e))&&(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),$(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=ri("path");t.options.className&&C(e,t.options.className),t.options.interactive&&C(e,"leaflet-interactive"),this._updateStyle(t),this._layers[v(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){U(t._path),t.removeInteractiveTarget(t._path),delete this._layers[v(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,An(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),s=Math.max(Math.round(t._radiusY),1)||i,r="a"+i+","+s+" 0 1,0 ",c=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+r+i*2+",0 "+r+-i*2+",0 ";this._setPath(t,c)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){ue(t._path)},_bringToBack:function(t){de(t._path)}});x.vml&&Oe.include(jr);function Co(t){return x.svg||x.vml?new Oe(t):null}D.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if(t==="overlayPane"||t===void 0)return!1;var e=this._paneRenderers[t];return e===void 0&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&ko(t)||Co(t)}});var Eo=pe.extend({initialize:function(t,e){pe.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=j(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function $r(t,e){return new Eo(t,e)}Oe.create=ri,Oe.pointsToPath=An,Zt.geometryToLayer=Qe,Zt.coordsToLatLng=ji,Zt.coordsToLatLngs=ti,Zt.latLngToCoords=$i,Zt.latLngsToCoords=ei,Zt.getFeature=ge,Zt.asFeature=ii,D.mergeOptions({boxZoom:!0});var Mo=At.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){k(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Z(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){U(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||t.which!==1&&t.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Te(),Mi(),this._startPoint=this._map.mouseEventToContainerPoint(t),k(document,{contextmenu:se,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=R("div","leaflet-zoom-box",this._container),C(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new H(this._point,this._startPoint),i=e.getSize();$(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(U(this._box),G(this._container,"leaflet-crosshair")),ke(),Ai(),Z(document,{contextmenu:se,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(!(t.which!==1&&t.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(g(this._resetState,this),0);var e=new rt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){t.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});D.addInitHook("addHandler","boxZoom",Mo),D.mergeOptions({doubleClickZoom:!0});var Ao=At.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),s=e.options.zoomDelta,r=t.originalEvent.shiftKey?i-s:i+s;e.options.doubleClickZoom==="center"?e.setZoom(r):e.setZoomAround(t.containerPoint,r)}});D.addInitHook("addHandler","doubleClickZoom",Ao),D.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Io=At.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new Gt(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}C(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){G(this._map._container,"leaflet-grab"),G(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=j(this._map.options.maxBounds);this._offsetLimit=st(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,s=this._draggable._newPos.x,r=(s-e+i)%t+e-i,c=(s+e+i)%t-e-i,h=Math.abs(r+i)<Math.abs(c+i)?r:c;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=h},_onDragEnd:function(t){var e=this._map,i=e.options,s=!i.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),s)e.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),c=(this._lastTime-this._times[0])/1e3,h=i.easeLinearity,m=r.multiplyBy(h/c),p=m.distanceTo([0,0]),_=Math.min(i.inertiaMaxSpeed,p),y=m.multiplyBy(_/p),S=_/(i.inertiaDeceleration*h),E=y.multiplyBy(-S/2).round();!E.x&&!E.y?e.fire("moveend"):(E=e._limitOffset(E,e.options.maxBounds),ot(function(){e.panBy(E,{duration:S,easeLinearity:h,noMoveStart:!0,animate:!0})}))}}});D.addInitHook("addHandler","dragging",Io),D.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Bo=At.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),k(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Z(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,i=t.scrollTop||e.scrollTop,s=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(s,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e=this._panKeys={},i=this.keyCodes,s,r;for(s=0,r=i.left.length;s<r;s++)e[i.left[s]]=[-1*t,0];for(s=0,r=i.right.length;s<r;s++)e[i.right[s]]=[t,0];for(s=0,r=i.down.length;s<r;s++)e[i.down[s]]=[0,t];for(s=0,r=i.up.length;s<r;s++)e[i.up[s]]=[0,-1*t]},_setZoomDelta:function(t){var e=this._zoomKeys={},i=this.keyCodes,s,r;for(s=0,r=i.zoomIn.length;s<r;s++)e[i.zoomIn[s]]=t;for(s=0,r=i.zoomOut.length;s<r;s++)e[i.zoomOut[s]]=-t},_addHooks:function(){k(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Z(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=t.keyCode,i=this._map,s;if(e in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(s=this._panKeys[e],t.shiftKey&&(s=P(s).multiplyBy(3)),i.options.maxBounds&&(s=i._limitOffset(P(s),i.options.maxBounds)),i.options.worldCopyJump){var r=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(s)));i.panTo(r)}else i.panBy(s)}else if(e in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[e]);else if(e===27&&i._popup&&i._popup.options.closeOnEscapeKey)i.closePopup();else return;se(t)}}});D.addInitHook("addHandler","keyboard",Bo),D.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var zo=At.extend({addHooks:function(){k(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Z(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=no(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var s=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(g(this._performZoom,this),s),se(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var s=this._delta/(this._map.options.wheelPxPerZoomLevel*4),r=4*Math.log(2/(1+Math.exp(-Math.abs(s))))/Math.LN2,c=i?Math.ceil(r/i)*i:r,h=t._limitZoom(e+(this._delta>0?c:-c))-e;this._delta=0,this._startTime=null,h&&(t.options.scrollWheelZoom==="center"?t.setZoom(e+h):t.setZoomAround(this._lastMousePos,e+h))}});D.addInitHook("addHandler","scrollWheelZoom",zo);var Kr=600;D.mergeOptions({tapHold:x.touchNative&&x.safari&&x.mobile,tapTolerance:15});var Oo=At.extend({addHooks:function(){k(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Z(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),t.touches.length===1){var e=t.touches[0];this._startPos=this._newPos=new T(e.clientX,e.clientY),this._holdTimeout=setTimeout(g(function(){this._cancel(),this._isTapValid()&&(k(document,"touchend",Q),k(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),Kr),k(document,"touchend touchcancel contextmenu",this._cancel,this),k(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){Z(document,"touchend",Q),Z(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),Z(document,"touchend touchcancel contextmenu",this._cancel,this),Z(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new T(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});i._simulated=!0,e.target.dispatchEvent(i)}});D.addInitHook("addHandler","tapHold",Oo),D.mergeOptions({touchZoom:x.touch,bounceAtZoomLimits:!0});var Do=At.extend({addHooks:function(){C(this._map._container,"leaflet-touch-zoom"),k(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){G(this._map._container,"leaflet-touch-zoom"),Z(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(!(!t.touches||t.touches.length!==2||e._animatingZoom||this._zooming)){var i=e.mouseEventToContainerPoint(t.touches[0]),s=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),e.options.touchZoom!=="center"&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(s)._divideBy(2))),this._startDist=i.distanceTo(s),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),k(document,"touchmove",this._onTouchMove,this),k(document,"touchend touchcancel",this._onTouchEnd,this),Q(t)}},_onTouchMove:function(t){if(!(!t.touches||t.touches.length!==2||!this._zooming)){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),s=e.mouseEventToContainerPoint(t.touches[1]),r=i.distanceTo(s)/this._startDist;if(this._zoom=e.getScaleZoom(r,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&r<1||this._zoom>e.getMaxZoom()&&r>1)&&(this._zoom=e._limitZoom(this._zoom)),e.options.touchZoom==="center"){if(this._center=this._startLatLng,r===1)return}else{var c=i._add(s)._divideBy(2)._subtract(this._centerPoint);if(r===1&&c.x===0&&c.y===0)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(c),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),pt(this._animRequest);var h=g(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ot(h,this,!0),Q(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,pt(this._animRequest),Z(document,"touchmove",this._onTouchMove,this),Z(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});D.addInitHook("addHandler","touchZoom",Do),D.BoxZoom=Mo,D.DoubleClickZoom=Ao,D.Drag=Io,D.Keyboard=Bo,D.ScrollWheelZoom=zo,D.TapHold=Oo,D.TouchZoom=Do,o.Bounds=H,o.Browser=x,o.CRS=Dt,o.Canvas=To,o.Circle=Vi,o.CircleMarker=Xe,o.Class=Ot,o.Control=St,o.DivIcon=xo,o.DivOverlay=It,o.DomEvent=fr,o.DomUtil=ur,o.Draggable=Gt,o.Evented=be,o.FeatureGroup=Rt,o.GeoJSON=Zt,o.GridLayer=Be,o.Handler=At,o.Icon=me,o.ImageOverlay=ni,o.LatLng=N,o.LatLngBounds=rt,o.Layer=Pt,o.LayerGroup=fe,o.LineUtil=Tr,o.Map=D,o.Marker=Je,o.Mixin=wr,o.Path=Vt,o.Point=T,o.PolyUtil=br,o.Polygon=pe,o.Polyline=Nt,o.Popup=oi,o.PosAnimation=oo,o.Projection=kr,o.Rectangle=Eo,o.Renderer=Ft,o.SVG=Oe,o.SVGOverlay=Lo,o.TileLayer=_e,o.Tooltip=si,o.Transformation=vi,o.Util=Bs,o.VideoOverlay=bo,o.bind=g,o.bounds=st,o.canvas=ko,o.circle=Or,o.circleMarker=zr,o.control=Me,o.divIcon=Wr,o.extend=l,o.featureGroup=Ar,o.geoJSON=wo,o.geoJson=Nr,o.gridLayer=Gr,o.icon=Ir,o.imageOverlay=Zr,o.latLng=O,o.latLngBounds=j,o.layerGroup=Mr,o.map=mr,o.marker=Br,o.point=P,o.polygon=Rr,o.polyline=Dr,o.popup=Ur,o.rectangle=$r,o.setOptions=F,o.stamp=v,o.svg=Co,o.svgOverlay=Hr,o.tileLayer=So,o.tooltip=qr,o.transformation=Le,o.version=a,o.videoOverlay=Fr;var Yr=window.L;o.noConflict=function(){return window.L=Yr,this},window.L=o})}(Re,Re.exports)),Re.exports}var yt=Pa();const Ta="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",ka="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg==",Ca="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC";var ae,X,lt,Bt,Tt,it,te,Xo,Qo,ts;let Jo=(it=class{constructor(n,o={}){I(this,te);I(this,ae,5);I(this,X,null);I(this,lt,{});I(this,Bt,{});I(this,Tt,null);z(this,ae,o.zoom??f(this,ae)),w(this,te,Xo).call(this);const a=o.defaultLayer||"openstreetmap",l=f(this,lt)[a]||Object.values(f(this,lt))[0],u={...o};delete u.defaultLayer,delete u.showLayerControl,delete u.overlays,z(this,X,yt.map(document.querySelector(n),{zoom:f(this,ae),scrollWheelZoom:!1,layers:[l],...u})),(Object.keys(f(this,lt)).length>1||o.showLayerControl!==!1)&&w(this,te,ts).call(this),o.overlays&&w(this,te,Qo).call(this,o.overlays)}static isGeolocationAvailable(){return"geolocation"in navigator}static getCurrentPosition(n={}){return new Promise((o,a)=>{if(!it.isGeolocationAvailable()){a("Geolocation API unsupported");return}navigator.geolocation.getCurrentPosition(o,a,n)})}static async build(n,o={}){if("center"in o&&o.center)return new it(n,o);const a=[-6.2,106.816666];if("locate"in o&&o.locate)try{const l=await it.getCurrentPosition(),u=[l.coords.latitude,l.coords.longitude];return new it(n,{...o,center:u})}catch(l){return console.error("build: error:",l),new it(n,{...o,center:a})}return new it(n,{...o,center:a})}addBaseLayer(n,o,a={}){const l=yt.tileLayer(o,{attribution:a.attribution||"",maxZoom:a.maxZoom||18,subdomains:a.subdomains||"",...a});return f(this,lt)[n]=l,f(this,Tt)&&f(this,Tt).addBaseLayer(l,n),l}addOverlayLayer(n,o,a={}){const l=yt.tileLayer(o,{attribution:a.attribution||"",maxZoom:a.maxZoom||18,opacity:a.opacity||.7,subdomains:a.subdomains||"",...a});return f(this,Bt)[n]=l,f(this,Tt)&&f(this,Tt).addOverlay(l,n),l}switchToLayer(n){const o=f(this,lt)[n];o?(Object.values(f(this,lt)).forEach(a=>{f(this,X).removeLayer(a)}),o.addTo(f(this,X))):console.warn(`Layer "${n}" not found`)}toggleOverlay(n){const o=f(this,Bt)[n];o?f(this,X).hasLayer(o)?f(this,X).removeLayer(o):o.addTo(f(this,X)):console.warn(`Overlay "${n}" not found`)}getAvailableLayers(){return{baseLayers:Object.keys(f(this,lt)),overlayLayers:Object.keys(f(this,Bt))}}removeLayer(n,o=!1){const a=o?f(this,Bt):f(this,lt),l=a[n];l&&(f(this,X).removeLayer(l),delete a[n],f(this,Tt)&&f(this,Tt).removeLayer(l))}createIcon(n={}){return yt.icon({...yt.Icon.Default.prototype.options,iconRetinaUrl:ka,iconUrl:Ta,shadowUrl:Ca,...n})}addMarker(n,o={},a=null){if(typeof o!="object")throw new Error("markerOptions must be an object");const l=yt.marker(n,{icon:this.createIcon(),...o});if(a){if(typeof a!="object")throw new Error("popupOptions must be an object");if(!("content"in a))throw new Error("popupOptions must include `content` property.");const u=yt.popup(n,a);l.bindPopup(u)}return l.addTo(f(this,X)),l}changeCamera(n,o=null){if(!o){f(this,X).setView(yt.latLng(n),f(this,ae));return}f(this,X).setView(yt.latLng(n),o)}getCenter(){const{lat:n,lng:o}=f(this,X).getCenter();return{latitude:n,longitude:o}}getMapInstance(){return f(this,X)}getCurrentLayer(){for(const[n,o]of Object.entries(f(this,lt)))if(f(this,X).hasLayer(o))return n;return null}getActiveOverlays(){const n=[];for(const[o,a]of Object.entries(f(this,Bt)))f(this,X).hasLayer(a)&&n.push(o);return n}},ae=new WeakMap,X=new WeakMap,lt=new WeakMap,Bt=new WeakMap,Tt=new WeakMap,te=new WeakSet,Xo=function(){[{key:"openstreetmap",name:"OpenStreetMap",config:it.LAYER_CONFIGS.openstreetmap},{key:"satellite",name:"Satellite",config:it.LAYER_CONFIGS.satellite},{key:"dark",name:"Dark Mode",config:it.LAYER_CONFIGS.dark},{key:"cartodb",name:"CartoDB Positron",config:it.LAYER_CONFIGS.cartodb}].forEach(({name:o,config:a})=>{f(this,lt)[o]=yt.tileLayer(a.url,{attribution:a.attribution,maxZoom:a.maxZoom,subdomains:a.subdomains||""})})},Qo=function(n){n.forEach(o=>{f(this,Bt)[o.name]=yt.tileLayer(o.url,{attribution:o.attribution,maxZoom:o.maxZoom||18,opacity:o.opacity||.7,subdomains:o.subdomains||""})})},ts=function(){z(this,Tt,yt.control.layers(f(this,lt),f(this,Bt),{position:"topright",collapsed:!0})),f(this,Tt).addTo(f(this,X))},Ji(it,"LAYER_CONFIGS",{openstreetmap:{name:"OpenStreetMap",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>',maxZoom:19},satellite:{name:"Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:'&copy; <a href="https://www.arcgis.com/" target="_blank">ArcGIS</a>',maxZoom:18},dark:{name:"Dark Mode",url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/" target="_blank">Stadia Maps</a>, &copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>',maxZoom:20},cartodb:{name:"CartoDB Positron",url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>, &copy; <a href="https://cartodb.com/attributions" target="_blank">CartoDB</a>',subdomains:"abcd",maxZoom:19}}),it);class wn{constructor(n="#map"){this.containerId=n,this.map=null,this.markers=[],this.customControls=null,this.currentEscapeHandler=null}formatDate(n){return new Date(n).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}async getLocationName(n,o){if(n==null||o==null||typeof n!="number"||typeof o!="number")return"Unknown Location";try{return await vn(o,n)}catch(a){return console.error("Error getting location:",a),`${n.toFixed(4)}, ${o.toFixed(4)}`}}async initialize(n={}){try{const a={...{center:[-6.2,106.816666],zoom:6,locate:!1,defaultLayer:"openstreetmap",showLayerControl:!0,customLayers:[{name:"Custom Terrain",url:"https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png",attribution:"&copy; Stamen Design, &copy; OpenStreetMap",subdomains:"abcd"}],overlays:[]},...n};return this.map=await Jo.build(this.containerId,a),this.addCustomMapControls(),this.hideLoadingContainer(),console.log("Map initialized successfully"),this.map}catch(o){throw console.error("Error initializing map:",o),this.showMapError(o),o}}async addStoryMarkers(n,o=null){if(!this.map||!n||!Array.isArray(n)){console.warn("Map not initialized or invalid stories data");return}this.clearMarkers();for(const a of n)if(a.lat&&a.lon&&typeof a.lat=="number"&&typeof a.lon=="number"){let l="Loading location...";try{l=await this.getLocationName(a.lat,a.lon)}catch{l=`${a.lat.toFixed(4)}, ${a.lon.toFixed(4)}`}const u=this.map.addMarker([a.lat,a.lon],{title:a.name},{content:this.createMarkerPopupContent(a,l)});o&&u.on("click",()=>{o(a)}),this.markers.push({marker:u,story:a,locationName:l})}console.log(`Added ${this.markers.length} markers to map`)}createMarkerPopupContent(n,o){return`
      <div style="text-align: center; min-width: 200px;">
        <img src="${n.photoUrl}" 
             style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 8px;" 
             alt="${n.name}">
        <h4 style="margin: 0 0 4px 0; font-size: 14px;">${n.name}</h4>
        <p style="margin: 0 0 8px 0; font-size: 12px; color: #666;">${n.description.substring(0,100)}...</p>
        <p style="margin: 0 0 8px 0; font-size: 11px; color: #007bff;">üìç ${o}</p>
        <small style="color: #888;">${this.formatDate(n.createdAt)}</small>
      </div>
    `}addCustomMapControls(){if(!this.map)return;const n=document.querySelector(this.containerId);if(!n)return;this.customControls&&this.customControls.remove();const o=document.createElement("div");o.className="map-custom-controls",o.style.cssText=`
      position: absolute;
      top: 10px;
      left: 50px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      padding: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    `;const a=this.map.getAvailableLayers();a&&a.baseLayers&&a.baseLayers.forEach(l=>{const u=this.createLayerButton(l,o);o.appendChild(u)}),n.appendChild(o),this.customControls=o}createLayerButton(n,o){const a=document.createElement("button");return a.textContent=n,a.className="map-layer-button",a.style.cssText=`
      margin: 2px;
      padding: 4px 8px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s ease;
    `,a.addEventListener("click",()=>{this.switchToLayer(n),this.updateActiveButton(o,a)}),this.map&&n===this.map.getCurrentLayer()&&(a.style.background="#007bff",a.style.color="white"),a}switchToLayer(n){this.map&&this.map.switchToLayer(n)}updateActiveButton(n,o){n.querySelectorAll(".map-layer-button").forEach(l=>{l.style.background="white",l.style.color="black"}),o.style.background="#007bff",o.style.color="white"}setupLayerChangeListener(n=null){if(!this.map)return;const o=this.map.getMapInstance();o&&o.on("baselayerchange",a=>{const l=document.getElementById("current-layer-info");l&&(l.textContent=`Current Layer: ${a.name}`),n&&typeof n=="function"&&n(a)})}focusOnStory(n,o=12){this.map&&n.lat&&n.lon&&this.map.changeCamera([n.lat,n.lon],o)}clearMarkers(){this.markers=[],this.map&&typeof this.map.clearMarkers=="function"&&this.map.clearMarkers()}hideLoadingContainer(){const n=document.getElementById("map-loading-container");n&&(n.style.display="none")}showMapError(n){const o=document.querySelector(this.containerId);o&&(o.innerHTML=`
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
          <div style="text-align: center;">
            <h3>Unable to load map</h3>
            <p>${n.message||"Please check your internet connection."}</p>
            <button onclick="window.location.reload()" style="margin-top: 10px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
              Retry
            </button>
          </div>
        </div>
      `),this.hideLoadingContainer()}getMapInfo(){return this.map?{currentLayer:this.map.getCurrentLayer?this.map.getCurrentLayer():"Unknown",markersCount:this.markers.length,availableLayers:this.map.getAvailableLayers?this.map.getAvailableLayers():null}:null}getMapInstance(){return this.map}destroy(){this.customControls&&(this.customControls.remove(),this.customControls=null),this.clearMarkers(),this.currentEscapeHandler&&(document.removeEventListener("keydown",this.currentEscapeHandler),this.currentEscapeHandler=null),this.map&&typeof this.map.destroy=="function"&&this.map.destroy(),this.map=null}static async create(n,o=[],a={}){const l=new wn(n);return await l.initialize(a),o.length>0&&await l.addStoryMarkers(o),l}}class bn{constructor(n="#filter-container"){this.containerId=n,this.filters={search:"",location:"all",dateRange:"all",sortBy:"newest"},this.originalData=[],this.filteredData=[],this.onFilterChange=null,this.debounceTimer=null}initialize(n=[],o={}){this.originalData=[...n],this.filteredData=[...n];const a={showSearch:!0,showLocation:!0,showDateRange:!0,showSort:!0,debounceTime:300};return this.options={...a,...o},this.render(),this.setupEventListeners(),this}onFilterChangeCallback(n){return this.onFilterChange=n,this}render(){const n=document.querySelector(this.containerId);if(!n){console.error(`Filter container ${this.containerId} not found`);return}n.innerHTML=`
        <div class="filter-component">
          <div class="filter-header">
            <h3 class="filter-title">Filter Stories</h3>
            <button class="filter-reset-btn" type="button">Reset</button>
          </div>
          
          <div class="filter-content">
            ${this.options.showSearch?this.renderSearchFilter():""}
            ${this.options.showLocation?this.renderLocationFilter():""}
            ${this.options.showDateRange?this.renderDateRangeFilter():""}
            ${this.options.showSort?this.renderSortFilter():""}
          </div>
          
          <div class="filter-results">
            <span class="filter-results-count">
              Showing ${this.filteredData.length} of ${this.originalData.length} stories
            </span>
          </div>
        </div>
      `}renderSearchFilter(){return`
        <div class="filter-group">
          <label class="filter-label" for="search-input">Search</label>
          <input 
            type="text" 
            id="search-input" 
            class="filter-input" 
            placeholder="Search by title or description..."
            value="${this.filters.search}"
          >
        </div>
      `}renderLocationFilter(){return`
        <div class="filter-group">
          <label class="filter-label" for="location-select">Location</label>
          <select id="location-select" class="filter-select">
            <option value="all">All Locations</option>
            ${this.getUniqueLocations().map(o=>`<option value="${o}" ${this.filters.location===o?"selected":""}>${o}</option>`).join("")}
          </select>
        </div>
      `}renderDateRangeFilter(){return`
        <div class="filter-group">
          <label class="filter-label" for="date-select">Date Range</label>
          <select id="date-select" class="filter-select">
            <option value="all" ${this.filters.dateRange==="all"?"selected":""}>All Time</option>
            <option value="today" ${this.filters.dateRange==="today"?"selected":""}>Today</option>
            <option value="week" ${this.filters.dateRange==="week"?"selected":""}>This Week</option>
            <option value="month" ${this.filters.dateRange==="month"?"selected":""}>This Month</option>
            <option value="year" ${this.filters.dateRange==="year"?"selected":""}>This Year</option>
          </select>
        </div>
      `}renderSortFilter(){return`
        <div class="filter-group">
          <label class="filter-label" for="sort-select">Sort By</label>
          <select id="sort-select" class="filter-select">
            <option value="newest" ${this.filters.sortBy==="newest"?"selected":""}>Newest First</option>
            <option value="oldest" ${this.filters.sortBy==="oldest"?"selected":""}>Oldest First</option>
            <option value="name-asc" ${this.filters.sortBy==="name-asc"?"selected":""}>Name A-Z</option>
            <option value="name-desc" ${this.filters.sortBy==="name-desc"?"selected":""}>Name Z-A</option>
          </select>
        </div>
      `}setupEventListeners(){const n=document.querySelector(this.containerId);if(!n)return;const o=n.querySelector("#search-input");o&&o.addEventListener("input",b=>{this.debounceFilter(()=>{this.filters.search=b.target.value.trim(),this.applyFilters()})});const a=n.querySelector("#location-select");a&&a.addEventListener("change",b=>{this.filters.location=b.target.value,this.applyFilters()});const l=n.querySelector("#date-select");l&&l.addEventListener("change",b=>{this.filters.dateRange=b.target.value,this.applyFilters()});const u=n.querySelector("#sort-select");u&&u.addEventListener("change",b=>{this.filters.sortBy=b.target.value,this.applyFilters()});const g=n.querySelector(".filter-reset-btn");g&&g.addEventListener("click",()=>{this.resetFilters()})}debounceFilter(n){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(n,this.options.debounceTime)}getUniqueLocations(){const n=new Set;return this.originalData.forEach(o=>{o.location&&o.location!=="Unknown Location"&&n.add(o.location)}),Array.from(n).sort()}applyFilters(){let n=[...this.originalData];if(this.filters.search){const o=this.filters.search.toLowerCase();n=n.filter(a=>a.name.toLowerCase().includes(o)||a.description.toLowerCase().includes(o))}this.filters.location!=="all"&&(n=n.filter(o=>o.location===this.filters.location)),this.filters.dateRange!=="all"&&(n=n.filter(o=>this.isWithinDateRange(o.createdAt,this.filters.dateRange))),n=this.sortData(n,this.filters.sortBy),this.filteredData=n,this.updateResultsCount(),this.onFilterChange&&this.onFilterChange(this.filteredData,this.filters)}isWithinDateRange(n,o){const a=new Date(n),l=new Date;switch(o){case"today":return a.toDateString()===l.toDateString();case"week":const u=new Date(l.getTime()-7*24*60*60*1e3);return a>=u;case"month":const g=new Date(l.getFullYear(),l.getMonth()-1,l.getDate());return a>=g;case"year":const b=new Date(l.getFullYear()-1,l.getMonth(),l.getDate());return a>=b;default:return!0}}sortData(n,o){const a=[...n];switch(o){case"newest":return a.sort((l,u)=>new Date(u.createdAt)-new Date(l.createdAt));case"oldest":return a.sort((l,u)=>new Date(l.createdAt)-new Date(u.createdAt));case"name-asc":return a.sort((l,u)=>l.name.localeCompare(u.name));case"name-desc":return a.sort((l,u)=>u.name.localeCompare(l.name));default:return a}}updateResultsCount(){const n=document.querySelector(`${this.containerId} .filter-results-count`);n&&(n.textContent=`Showing ${this.filteredData.length} of ${this.originalData.length} stories`)}resetFilters(){this.filters={search:"",location:"all",dateRange:"all",sortBy:"newest"};const n=document.querySelector(this.containerId);if(n){const o=n.querySelector("#search-input"),a=n.querySelector("#location-select"),l=n.querySelector("#date-select"),u=n.querySelector("#sort-select");o&&(o.value=""),a&&(a.value="all"),l&&(l.value="all"),u&&(u.value="newest")}this.applyFilters()}updateData(n){if(this.originalData=[...n],this.applyFilters(),this.options.showLocation){const o=document.querySelector(`${this.containerId} #location-select`);if(o){const a=this.getUniqueLocations(),l=o.value;o.innerHTML=`
            <option value="all">All Locations</option>
            ${a.map(u=>`<option value="${u}" ${l===u?"selected":""}>${u}</option>`).join("")}
          `}}}getCurrentFilters(){return{...this.filters}}getFilteredData(){return[...this.filteredData]}setFilter(n,o){if(this.filters.hasOwnProperty(n)){this.filters[n]=o;const a=document.querySelector(this.containerId);if(a){const l=a.querySelector(`#${n}-input, #${n}-select`);l&&(l.value=o)}this.applyFilters()}}toggle(n=null){const o=document.querySelector(this.containerId);o&&(n===null?o.style.display=o.style.display==="none"?"block":"none":o.style.display=n?"block":"none")}destroy(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null);const n=document.querySelector(this.containerId);n&&(n.innerHTML=""),this.originalData=[],this.filteredData=[],this.onFilterChange=null}static create(n,o=[],a={}){const l=new bn(n);return l.initialize(o,a),l}}class ht{static saveToken(n){try{return localStorage.setItem(this.TOKEN_KEY,n),!0}catch(o){return console.error("Error saving token:",o),!1}}static getToken(){try{const n=localStorage.getItem(this.TOKEN_KEY);return n==="null"||n==="undefined"||!n?null:n}catch(n){return console.error("Error getting token:",n),null}}static removeToken(){try{return localStorage.removeItem(this.TOKEN_KEY),!0}catch(n){return console.error("Error removing token:",n),!1}}static isAuthenticated(){return this.getToken()!==null}static clearAuthData(){this.removeToken()}}Ji(ht,"TOKEN_KEY","authToken");class Ea{constructor(){this.data=null,this.mapComponent=null,this.filterComponent=null,this.city=[],this.storyModal=new yn,this.currentFilteredData=[],this.isProcessingFilter=!1,this.locationCache=new Map,this.token=ht.getToken()}formatDate(n){return new Date(n).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}async getLocationName(n,o){if(n==null||o==null||typeof n!="number"||typeof o!="number")return"Unknown Location";const a=`${n.toFixed(4)},${o.toFixed(4)}`;if(this.locationCache.has(a))return this.locationCache.get(a);try{const l=await vn(o,n);return this.locationCache.set(a,l),this.city.includes(l)||this.city.push(l),l}catch(l){console.error("Error getting location:",l);const u=`${n.toFixed(4)}, ${o.toFixed(4)}`;return this.locationCache.set(a,u),u}}createStoryCard(n,o="Loading..."){return`
      <div class="story-card" data-story-id="${n.id||""}" data-lat="${n.lat}" data-lon="${n.lon}" data-location-loading="true">
        <div class="card-image">
          <img src="${n.photoUrl}" alt="${n.name}" loading="lazy">
          <div class="card-overlay">
            <span class="location">üìç ${o}</span>
          </div>
        </div>
        <div class="card-content">
          <h3 class="card-title">${n.name}</h3>
          <p class="card-description">${n.description}</p>
          <div class="card-meta">
            <span class="card-date">üïí ${this.formatDate(n.createdAt)}</span>
          </div>
        </div>
      </div>
    `}async initializeMap(){var n;try{console.log("Initializing map..."),this.mapComponent=new wn("#map"),await this.mapComponent.initialize({center:[-6.2,106.816666],zoom:6,locate:!1,defaultLayer:"openstreetmap",showLayerControl:!0,customLayers:[{name:"Custom Terrain",url:"https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png",attribution:"&copy; Stamen Design, &copy; OpenStreetMap",subdomains:"abcd"}]});const o=this.currentFilteredData.length>0?this.currentFilteredData:((n=this.data)==null?void 0:n.listStory)||[];o.length>0&&await this.mapComponent.addStoryMarkers(o,a=>this.showStoryDetail(a)),this.mapComponent.setupLayerChangeListener(a=>{console.log("Layer changed to:",a.name)}),console.log("Map initialized successfully")}catch(o){console.error("Error initializing map:",o)}}initializeFilter(){try{if(this.filterComponent){console.log("Filter already initialized, skipping...");return}const n=this.data.listStory.map(o=>({...o,location:o.location||"Loading..."}));this.filterComponent=bn.create("#filter-container",n,{showSearch:!0,showLocation:!0,showDateRange:!0,showSort:!0,debounceTime:300}),this.filterComponent.isInitialized=!1,this.filterComponent.onFilterChangeCallback((o,a)=>{this.handleFilterChange(o,a)}),this.currentFilteredData=[...n],console.log("Filter initialized successfully")}catch(n){console.error("Error initializing filter:",n)}}async handleFilterChange(n,o){if(this.isProcessingFilter){console.log("Filter change already in progress, skipping...");return}this.isProcessingFilter=!0;try{this.currentFilteredData=n,await this.updateStoryCardsDisplay(n),this.mapComponent&&await this.mapComponent.addStoryMarkers(n,a=>this.showStoryDetail(a)),this.updateStatsDisplay(n)}finally{this.isProcessingFilter=!1}}async updateStoryCardsDisplay(n){const o=document.querySelector(".stories-grid");if(!o)return;if(n.length===0){o.innerHTML=`
        <div class="no-results">
          <h3>No stories found</h3>
          <p>Try adjusting your filters to see more results.</p>
        </div>
      `;return}const a=n.map(l=>this.createStoryCard(l)).join("");o.innerHTML=a,this.setupStoryCardInteractions(),await this.updateCardLocations()}updateStatsDisplay(n){const o=document.querySelector(".stat-item:nth-child(1) .stat-number");o&&(o.textContent=n.length);const a=document.querySelector(".stat-item:nth-child(2) .stat-number");a&&(a.textContent=new Set(n.map(g=>g.name)).size);const l=document.querySelector(".stat-item:nth-child(3) .stat-number");if(l){const g=new Set(n.filter(b=>b.location&&b.location!=="Unknown Location").map(b=>b.location));l.textContent=g.size}const u=document.getElementById("current-layer-info");if(u&&u.parentElement){const g=u.parentElement.querySelector("div:last-child");g&&(g.textContent=`Stories: ${n.length} locations`)}}async render(){try{if(this.token=ht.getToken(),!this.token)return this.data=null,this.currentFilteredData=[],`
          <section class="stories-container">
            <div class="page-header">
              <h1 class="page-title">Stories</h1>
              <p class="page-subtitle">Silakan login untuk melihat cerita.</p>
            </div>
            <div class="error">
              <h3>Butuh autentikasi</h3>
              <p>Masuk terlebih dahulu untuk memuat data story.</p>
              <a class="btn" href="#/login">Login sekarang</a>
            </div>
          </section>
        `;if(this.data=await la(this.token),!this.data||!this.data.listStory||this.data.listStory.length===0)return this.renderEmptyState();const n=this.data.listStory;this.currentFilteredData=[...n];const o=n.map(a=>this.createStoryCard(a)).join("");return`
        <section>
          <div class="reports-list__map__container" style="position: relative; margin-bottom: 2rem; max-width: 95vw; margin-left: auto; margin-right: auto;">
            <div id="map" class="reports-list__map" style="height: 1600px; width: 100%; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); position: relative;"></div>
            <div id="map-loading-container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.9); padding: 1rem; border-radius: 8px;">
              <p style="margin: 0; color: #666;">Loading map...</p>
            </div>
            
            <!-- Map Info Panel -->
            ${this.createMapInfoPanel(n)}
          </div>
        </section>

        <section class="stories-container">
          <div class="page-header">
            <h1 class="page-title">Stories</h1>
            <p class="page-subtitle">Discover amazing stories from our community</p>
            
            <!-- Toggle Filter Button -->
            <button class="filter-toggle-btn" type="button">
              <span class="filter-icon">üîç</span>
              Filter Stories
            </button>
          </div>
          
          <!-- Filter Container -->
          <div id="filter-container" class="filter-wrapper" style="display: none;"></div>
          
          ${this.createStatsBar(n)}

          <div class="stories-grid">
            ${o}
          </div>
        </section>
      `}catch(n){return console.error("Error fetching data:",n),this.renderErrorState(n)}}renderEmptyState(){return`
      <section>
        <div class="reports-list__map__container">
          <div id="map" class="reports-list__map" style="height: 1600px; width: 100%; max-width: 95vw; margin: 0 auto; position: relative;"></div>
          <div id="map-loading-container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <p>Loading map...</p>
          </div>
        </div>
      </section>
      
      <section class="stories-container">
        <div class="page-header">
          <h1 class="page-title">Stories</h1>
          <p class="page-subtitle">No stories available</p>
        </div>
      </section>
    `}renderErrorState(n){return`
      <section class="stories-container">
        <div class="page-header">
          <h1 class="page-title">Stories</h1>
        </div>
        <div class="error">
          <h3>Error Loading Stories</h3>
          <p>${n.message}</p>
          <button onclick="window.location.reload()" style="margin-top: 10px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Retry
          </button>
        </div>
      </section>
    `}createMapInfoPanel(n){return`
      <div style="position: absolute; bottom: 10px; right: 10px; background: rgba(255, 255, 255, 0.9); padding: 8px 12px; border-radius: 6px; font-size: 12px; color: #666;">
        <div id="current-layer-info">Current Layer: OpenStreetMap</div>
        <div>Stories: ${n.length} locations</div>
      </div>
    `}createStatsBar(n){return`
      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-number">${n.length}</span>
          <span class="stat-label">Total Stories</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">${new Set(n.map(o=>o.name)).size}</span>
          <span class="stat-label">Contributors</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">Loading...</span>
          <span class="stat-label">Locations</span>
        </div>
      </div>
    `}async afterRender(){try{if(!this.data||!this.data.listStory||this.data.listStory.length===0)return;this.initializeFilter(),await this.initializeMap(),await this.updateCardLocations(),this.setupStoryCardInteractions(),this.setupFilterToggle()}catch(n){console.error("Error in afterRender:",n)}}setupFilterToggle(){const n=document.querySelector(".filter-toggle-btn"),o=document.querySelector("#filter-container");n&&o&&n.addEventListener("click",()=>{const a=o.style.display!=="none";o.style.display=a?"none":"block";const l=n.querySelector(".filter-icon");l&&(l.textContent=a?"üîç":"‚úï")})}setupStoryCardInteractions(){document.querySelectorAll(".story-card").forEach(a=>{a.replaceWith(a.cloneNode(!0))}),document.querySelectorAll(".story-card").forEach(a=>{a.addEventListener("click",()=>{const l=a.dataset.storyId,u=this.currentFilteredData.find(g=>g.id===l)||this.findStoryByCard(a);u&&this.showStoryDetail(u)}),a.addEventListener("mouseenter",()=>{const l=parseFloat(a.dataset.lat),u=parseFloat(a.dataset.lon);this.mapComponent&&!isNaN(l)&&!isNaN(u)&&(a.style.transform="translateY(-2px)",a.style.boxShadow="0 8px 25px rgba(0,0,0,0.15)")}),a.addEventListener("mouseleave",()=>{a.style.transform="",a.style.boxShadow=""})})}findStoryByCard(n){var u;const o=parseFloat(n.dataset.lat),a=parseFloat(n.dataset.lon),l=(u=n.querySelector(".card-title"))==null?void 0:u.textContent;return this.currentFilteredData.find(g=>g.lat===o&&g.lon===a&&g.name===l)}async updateCardLocations(){if(!this.data||!this.data.listStory)return;const n=document.querySelectorAll('.story-card[data-location-loading="true"]'),o=new Set,a=[];for(const l of n){const u=parseFloat(l.dataset.lat),g=parseFloat(l.dataset.lon);if(!isNaN(u)&&!isNaN(g)){const b=this.getLocationName(u,g).then(v=>{o.add(v);const A=l.querySelector(".location");A&&(A.textContent=`üìç ${v}`);const W=this.data.listStory.find(B=>B.lat===u&&B.lon===g);return W&&(W.location=v),l.removeAttribute("data-location-loading"),v}).catch(v=>{console.error("Error updating location for card:",v);const A=`${u.toFixed(4)}, ${g.toFixed(4)}`,W=l.querySelector(".location");W&&(W.textContent=`üìç ${A}`);const B=this.data.listStory.find(ut=>ut.lat===u&&ut.lon===g);return B&&(B.location=A),l.removeAttribute("data-location-loading"),A});a.push(b)}}if(a.length>0){await Promise.all(a);const l=document.querySelector(".stat-item:nth-child(3) .stat-number");if(l&&(l.textContent=o.size),this.filterComponent&&this.data&&!this.filterComponent.isInitialized){const u=this.data.listStory.map(g=>({...g,location:g.location||"Unknown Location"}));this.filterComponent.updateData(u),this.filterComponent.isInitialized=!0}}}focusOnStory(n){this.mapComponent&&this.mapComponent.focusOnStory(n)}async showStoryDetail(n){const o=this.mapComponent?this.mapComponent.getMapInstance():null;await this.storyModal.show(n,o)}getMapInfo(){return this.mapComponent?this.mapComponent.getMapInfo():null}switchMapLayer(n){this.mapComponent&&this.mapComponent.switchToLayer(n)}getCurrentFilters(){return this.filterComponent?this.filterComponent.getCurrentFilters():null}setFilter(n,o){this.filterComponent&&this.filterComponent.setFilter(n,o)}toggleFilter(n=null){const o=document.querySelector("#filter-container"),a=document.querySelector(".filter-toggle-btn");if(o&&a){const l=n!==null?n:o.style.display==="none";o.style.display=l?"block":"none";const u=a.querySelector(".filter-icon");u&&(u.textContent=l?"‚úï":"üîç")}}resetFilters(){this.filterComponent&&this.filterComponent.resetFilters()}getFilteredStories(){return[...this.currentFilteredData]}cleanup(){this.storyModal&&this.storyModal.close(),this.mapComponent&&(this.mapComponent.destroy(),this.mapComponent=null),this.filterComponent&&(this.filterComponent.destroy(),this.filterComponent=null),this.data=null,this.city=[],this.currentFilteredData=[]}async refreshComponents(){if(this.data&&this.data.listStory){if(this.filterComponent){const n=this.data.listStory.map(o=>({...o,location:o.location||"Unknown Location"}));this.filterComponent.updateData(n)}if(this.mapComponent){const n=this.currentFilteredData.length>0?this.currentFilteredData:this.data.listStory;await this.mapComponent.addStoryMarkers(n,o=>this.showStoryDetail(o))}}}exportViewState(){var n,o;return{filters:this.getCurrentFilters(),mapInfo:this.getMapInfo(),totalStories:((o=(n=this.data)==null?void 0:n.listStory)==null?void 0:o.length)||0,filteredCount:this.currentFilteredData.length}}async importViewState(n){n.filters&&this.filterComponent&&Object.entries(n.filters).forEach(([o,a])=>{this.setFilter(o,a)})}}class Ma{constructor(){this.data=null}async render(){return`
    <section class="about-container">
      <div class="about-header">
        <h1 class="about-title">About</h1>
        <p class="about-subtitle">Tentang aplikasi ini</p>
      </div>

      <div class="about-content">
        <p>
          Aplikasi ini merupakan <strong>Single Page Application (SPA)</strong> 
          yang dirancang untuk menampilkan data lokasi secara interaktif di peta digital 
          serta memungkinkan pengguna menambahkan data baru secara langsung ke dalam sistem. 
          Navigasi antar halaman berjalan mulus tanpa reload berkat penerapan hash routing 
          dan efek transisi halaman.
        </p>
        <p>
          Data diperoleh dari <strong>API eksternal</strong> dan ditampilkan dalam bentuk daftar 
          berisi gambar dan deskripsi teks. Setiap data divisualisasikan di peta dengan marker 
          dan popup informasi. Peta juga mendukung interaksi seperti filter lokasi 
          dan sinkronisasi antara daftar dan marker.
        </p>
        <p>
          Aplikasi menyediakan fitur <strong>tambah data baru</strong> melalui form yang 
          dilengkapi upload gambar, pemilihan koordinat lewat klik pada peta, serta validasi input. 
          Pesan sukses atau error ditampilkan untuk meningkatkan pengalaman pengguna.
        </p>
        <p>
          Dari sisi <strong>aksesibilitas</strong>, aplikasi menggunakan elemen HTML semantik, 
          teks alternatif pada gambar, label di setiap input, serta desain responsif 
          untuk perangkat mobile, tablet, dan desktop. Aplikasi ini juga dapat diakses 
          melalui keyboard dan memiliki fitur skip to content.
        </p>
      </div>
    </section>

    `}async afterRender(){}}class Aa{static validateRequired(n){for(let o in n)if(!n[o]||n[o].trim()==="")return{isValid:!1,message:`${o} is required`};return{isValid:!0}}static validateEmail(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?{isValid:!0}:{isValid:!1,message:"Please enter a valid email address"}}static validatePassword(n,o=8){return n.length<o?{isValid:!1,message:`Password must be at least ${o} characters long`}:{isValid:!0}}static validateRegisterData(n){const o=this.validateRequired({name:n.name,email:n.email,password:n.password});if(!o.isValid)return o;const a=this.validateEmail(n.email);if(!a.isValid)return a;const l=this.validatePassword(n.password);return l.isValid?{isValid:!0,message:"Validation successful"}:l}}class De{static showMessage(n,o="info",a="registerForm"){this.clearMessages();const l=document.createElement("div");l.className=`${o}-message message`;const u=this.getMessageIcon(o);l.textContent=u+n;const g=document.getElementById(a);g&&g.parentNode.insertBefore(l,g.nextSibling);const b=this.getMessageTimeout(o);setTimeout(()=>{this.removeMessage(l)},b)}static clearMessages(){document.querySelectorAll(".message, .success-message, .error-message, .info-message").forEach(o=>o.remove())}static getMessageIcon(n){return{success:"‚úÖ ",error:"‚ùå ",info:"‚ÑπÔ∏è ",warning:"‚ö†Ô∏è "}[n]||""}static getMessageTimeout(n){return{success:3e3,error:5e3,info:4e3,warning:4e3}[n]||3e3}static removeMessage(n){n&&n.parentNode&&n.remove()}static showLoading(n="Processing...",o="registerForm"){this.showMessage(n,"info",o)}static showSuccess(n,o="registerForm"){this.showMessage(n,"success",o)}static showError(n,o="registerForm"){this.showMessage(n,"error",o)}}class jo{static navigateTo(n){window.location.hash=n}static goToHome(){this.navigateTo("#/")}static goToLogin(){this.navigateTo("#/login")}static goToRegister(){this.navigateTo("#/register")}static goToDashboard(){this.navigateTo("#/dashboard")}static goToProfile(){this.navigateTo("#/profile")}static goBack(){window.history.back()}static goForward(){window.history.forward()}static getCurrentRoute(){return window.location.hash}static isCurrentRoute(n){return this.getCurrentRoute()===n}static navigateWithDelay(n,o=1e3){setTimeout(()=>{this.navigateTo(n)},o)}static redirectToExternal(n){window.location.href=n}static replaceTo(n){window.location.replace(window.location.origin+window.location.pathname+n)}}class Ia{static async makeRequest(n,o={}){try{const a=`${qt.BASE_URL}${n}`,u={...{headers:{"Content-Type":"application/json"}},...o},g=await fetch(a,u),b=await g.json();return{success:g.ok,data:b,status:g.status,message:b.message||(g.ok?"Request successful":"Request failed")}}catch(a){return{success:!1,data:null,status:0,message:a.message||"Network error occurred"}}}static async post(n,o){return this.makeRequest(n,{method:"POST",body:JSON.stringify(o)})}static async get(n){return this.makeRequest(n,{method:"GET"})}static async put(n,o){return this.makeRequest(n,{method:"PUT",body:JSON.stringify(o)})}static async delete(n){return this.makeRequest(n,{method:"DELETE"})}static async registerUser(n){const o=await this.post("/register",{name:n.name,email:n.email,password:n.password});return{success:o.success,data:o.data,error:o.success?null:o.message}}static async loginUser(n){const o=await this.post("/login",{email:n.email,password:n.password});return{success:o.success,data:o.data,error:o.success?null:o.message}}static async getUserProfile(n){return this.makeRequest("/profile",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}})}static async updateUserProfile(n,o){return this.makeRequest("/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(n)})}}class Ba{async render(){return`
        <section class="container">
          <h1>Register</h1>
          
          <form id="registerForm" class="register-form">
            <div class="form-group">
              <label for="name">Nama:</label>
              <input type="text" id="name" name="name" class="name" required>
            </div>
            
            <div class="form-group">
              <label for="email">Email:</label>
              <input type="email" id="email" name="email" required>
            </div>
            
            <div class="form-group">
              <label for="password">Password:</label>
              <input type="password" id="password" name="password" required>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="register-btn">Register</button>
              <button type="button" id="backToHome" class="back-btn">Back to Home</button>
            </div>
          </form>
        </section>
      `}async afterRender(){this.bindEvents()}bindEvents(){const n=document.getElementById("registerForm"),o=document.getElementById("backToHome");n&&n.addEventListener("submit",a=>this.handleSubmit(a)),o&&o.addEventListener("click",()=>jo.goToHome())}async handleSubmit(n){n.preventDefault();const o=n.target;o.classList.add("loading");try{const a=this.getFormData(o),l=Aa.validateRegisterData(a);if(!l.isValid){De.showError(l.message);return}const u=await Ia.registerUser(a);u.success?(De.showSuccess(`Registration successful! Welcome ${a.name}! Please check your email for verification.`),setTimeout(()=>{o.reset(),De.showMessage("Redirecting to login page...","info"),jo.navigateWithDelay("#/login",1e3)},2e3)):De.showError("Registration failed: "+u.error)}catch(a){De.showError("Registration failed: "+a.message)}finally{o.classList.remove("loading")}}getFormData(n){const o=new FormData(n);return{name:o.get("name").trim(),email:o.get("email").trim(),password:o.get("password")}}}class en{static showMessage(n,o){const a=document.querySelector(".success-message, .error-message");a&&a.remove();const l=document.createElement("div");l.className=`${o}-message`,l.textContent=n;const u=document.getElementById("loginForm");u.parentNode.insertBefore(l,u.nextSibling),setTimeout(()=>{l.parentNode&&l.remove()},5e3)}}const $o={BASE_URL:qt.BASE_URL,LOGIN:"/login"};class za{static async loginUser(n,o){const a=`${$o.BASE_URL}${$o.LOGIN}`;try{const l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:o})});if(!l.ok){const g=await l.json();throw new Error(g.message||"Login failed")}const u=await l.json();return u.loginResult&&u.loginResult.token&&ht.saveToken(u.loginResult.token),u}catch(l){throw new Error(`Login error: ${l.message}`)}}static saveToken(n){return ht.saveToken(n)}static getToken(){return ht.getToken()}static removeToken(){return ht.removeToken()}static isAuthenticated(){return ht.isAuthenticated()}static logout(){ht.clearAuthData()}}class Oa{static isValidEmail(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}static validateLoginForm(n,o){const a=[];return(!n||!o)&&a.push("Please fill in all fields"),n&&!this.isValidEmail(n)&&a.push("Please enter a valid email address"),o&&o.length<6&&a.push("Password must be at least 6 characters long"),a}}class Ne{static navigateTo(n){window.location.hash=n}static goToHome(){this.navigateTo("#/")}static goToLogin(){this.navigateTo("#/login")}static goToRegister(){this.navigateTo("#/register")}static goToDashboard(){this.navigateTo("#/about")}static goToProfile(){this.navigateTo("#/profile")}static goBack(){window.history.back()}static goForward(){window.history.forward()}static getCurrentRoute(){return window.location.hash}static isCurrentRoute(n){return this.getCurrentRoute()===n}static navigateWithDelay(n,o=1e3){setTimeout(()=>{this.navigateTo(n)},o)}static redirectToExternal(n){window.location.href=n}static replaceTo(n){window.location.replace(window.location.origin+window.location.pathname+n)}}class Da{constructor(){this.onLoginSuccess=null}setOnLoginSuccess(n){this.onLoginSuccess=n}async handleFormSubmission(n){n.preventDefault();const o=n.target;o.classList.add("loading");try{const a=new FormData(o),l=a.get("email").trim(),u=a.get("password"),g=Oa.validateLoginForm(l,u);if(g.length>0){en.showMessage(g[0],"error");return}const b=await za.loginUser(l,u);en.showMessage("Login successful! Redirecting...","success"),setTimeout(()=>{o.reset(),this.handleLoginSuccess(b)},1500)}catch(a){en.showMessage("Login failed: "+a.message,"error"),console.error("Login error:",a)}finally{o.classList.remove("loading")}}handleLoginSuccess(n){console.log("User logged in:",n),this.onLoginSuccess&&this.onLoginSuccess(n),Ne.goToHome()}}class Ra{constructor(){this.loginHandler=new Da}async render(){return`
            <section class="container">
                <h1>Login</h1>
                
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Password:</label>
                        <input type="password" id="loginPassword" name="password" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="login-btn">Login</button>
                        <button type="button" id="backToHomeFromLogin" class="back-btn">Back to Home</button>
                    </div>
                    
                    <div class="form-links">
                        <button type="button" id="goToRegister" class="link-btn">Don't have an account? Register here</button>
                    </div>
                </form>
            </section>
        `}async afterRender(){this.attachEventListeners()}attachEventListeners(){const n=document.getElementById("loginForm");n&&n.addEventListener("submit",l=>{this.loginHandler.handleFormSubmission(l)});const o=document.getElementById("backToHomeFromLogin");o&&o.addEventListener("click",()=>Ne.goToHome());const a=document.getElementById("goToRegister");a&&a.addEventListener("click",()=>Ne.goToRegister())}setOnLoginSuccess(n){this.loginHandler.setOnLoginSuccess(n)}navigateToDashboard(){Ne.goToHome()}navigateWithDelay(n,o=1e3){Ne.navigateWithDelay(n,o)}}class Na{constructor(){this.validationRules={description:{required:!0,minLength:10,maxLength:500,pattern:null},photo:{required:!0,maxSize:1024*1024,allowedTypes:["image/jpeg","image/jpg","image/png","image/gif"],allowedExtensions:[".jpg",".jpeg",".png",".gif"]},location:{required:!1,latRange:[-90,90],lonRange:[-180,180]}},this.errorMessages={description:{required:"Description is required",minLength:"Description should be at least 10 characters long",maxLength:"Description should not exceed 500 characters",invalid:"Description contains invalid characters"},photo:{required:"Photo is required - please upload a file or take a photo with camera",invalidType:"Please select a valid image file (JPG, PNG, GIF)",tooLarge:"File size must be less than 1MB",corrupted:"The selected file appears to be corrupted"},location:{invalidLat:"Latitude must be between -90 and 90",invalidLon:"Longitude must be between -180 and 180",invalidCoordinates:"Invalid coordinates provided"},general:{networkError:"Network error occurred. Please check your connection and try again.",serverError:"Server error occurred. Please try again later.",unauthorized:"Authentication failed. Please log in again.",fileTooLarge:"File too large. Please choose a smaller image.",tooManyRequests:"Too many requests. Please wait a moment and try again.",unknownError:"An unexpected error occurred. Please try again."}}}validateDescription(n){const o=[],a=this.validationRules.description,l=this.errorMessages.description,u=n?n.trim():"";return a.required&&!u&&o.push(l.required),u&&(a.minLength&&u.length<a.minLength&&o.push(l.minLength),a.maxLength&&u.length>a.maxLength&&o.push(l.maxLength),a.pattern&&!a.pattern.test(u)&&o.push(l.invalid)),{isValid:o.length===0,errors:o,value:u}}validatePhoto(n){const o=[],a=this.validationRules.photo,l=this.errorMessages.photo;if(a.required&&!n)return o.push(l.required),{isValid:!1,errors:o,value:null};if(!a.required&&!n)return{isValid:!0,errors:[],value:null};if(n&&!a.allowedTypes.includes(n.type)&&o.push(l.invalidType),n&&a.maxSize&&n.size>a.maxSize&&o.push(l.tooLarge),n&&n.name){const u="."+n.name.split(".").pop().toLowerCase();a.allowedExtensions.includes(u)||o.push(l.invalidType)}return n&&n.size===0&&o.push(l.corrupted),{isValid:o.length===0,errors:o,value:n}}validateLocation(n,o){const a=[],l=this.validationRules.location,u=this.errorMessages.location;if(!l.required&&(n===""||n===null||n===void 0)&&(o===""||o===null||o===void 0))return{isValid:!0,errors:[],value:null};if((n!==""&&n!==null&&n!==void 0)!=(o!==""&&o!==null&&o!==void 0)&&a.push(u.invalidCoordinates),n!==""&&n!==null&&n!==void 0){const g=parseFloat(n);(isNaN(g)||g<l.latRange[0]||g>l.latRange[1])&&a.push(u.invalidLat)}if(o!==""&&o!==null&&o!==void 0){const g=parseFloat(o);(isNaN(g)||g<l.lonRange[0]||g>l.lonRange[1])&&a.push(u.invalidLon)}return{isValid:a.length===0,errors:a,value:n!==""&&n!==null&&n!==void 0&&o!==""&&o!==null&&o!==void 0?{lat:parseFloat(n),lon:parseFloat(o)}:null}}validateForm(n){const o={isValid:!0,errors:{},fieldErrors:[],values:{}},a=this.validateDescription(n.description);o.errors.description=a.errors,o.values.description=a.value,a.isValid||(o.isValid=!1,o.fieldErrors.push(...a.errors));const l=this.validatePhoto(n.photo);o.errors.photo=l.errors,o.values.photo=l.value,l.isValid||(o.isValid=!1,o.fieldErrors.push(...l.errors));const u=this.validateLocation(n.lat,n.lon);return o.errors.location=u.errors,o.values.location=u.value,u.isValid||(o.isValid=!1,o.fieldErrors.push(...u.errors)),o}validateField(n,o){switch(n){case"description":return this.validateDescription(o);case"photo":return this.validatePhoto(o);case"location":return this.validateLocation(o==null?void 0:o.lat,o==null?void 0:o.lon);default:return{isValid:!0,errors:[],value:o}}}getFieldRules(n){return this.validationRules[n]||{}}getFieldMessages(n){return this.errorMessages[n]||{}}isFieldRequired(n){var o;return((o=this.validationRules[n])==null?void 0:o.required)||!1}formatFileSize(n){if(n===0)return"0 Bytes";const o=1024,a=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(n)/Math.log(o));return parseFloat((n/Math.pow(o,l)).toFixed(2))+" "+a[l]}parseNetworkError(n){const o=this.errorMessages.general;if(!n)return o.unknownError;const a=n.message||"";return a.includes("Failed to fetch")||a.includes("NetworkError")?o.networkError:a.includes("401")||a.includes("Unauthorized")?o.unauthorized:a.includes("413")||a.includes("Payload Too Large")?o.fileTooLarge:a.includes("429")||a.includes("Too Many Requests")?o.tooManyRequests:a.includes("500")||a.includes("502")||a.includes("503")||a.includes("504")?o.serverError:n.message||o.unknownError}updateValidationRules(n,o){this.validationRules[n]?this.validationRules[n]={...this.validationRules[n],...o}:this.validationRules[n]=o}updateErrorMessages(n,o){this.errorMessages[n]?this.errorMessages[n]={...this.errorMessages[n],...o}:this.errorMessages[n]=o}async validateFileTypeStrict(n){return n?new Promise(o=>{const a=new FileReader;a.onload=l=>{const u=new Uint8Array(l.target.result).subarray(0,4);let g="";for(let W=0;W<u.length;W++)g+=u[W].toString(16);const v={"89504e47":"image/png",ffd8ffe0:"image/jpeg",ffd8ffe1:"image/jpeg",ffd8ffe2:"image/jpeg",47494638:"image/gif"}[g],A=v&&this.validationRules.photo.allowedTypes.includes(v);o(A)},a.onerror=()=>o(!1),a.readAsArrayBuffer(n.slice(0,4))}):!1}sanitizeInput(n){return typeof n!="string"?n:n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}getValidationSummary(n){if(n.isValid)return"All fields are valid";const o=n.fieldErrors.length;return`Found ${o} validation error${o>1?"s":""}`}}var Kt,le,Yt,Jt,wt,Xt,ft,Fe,Ct,es,is,ns,cn;const Ln=class Ln{constructor({video:n,cameraSelect:o,canvas:a,options:l={}}){I(this,Ct);I(this,Kt);I(this,le,!1);I(this,Yt,640);I(this,Jt,0);I(this,wt);I(this,Xt);I(this,ft);I(this,Fe);z(this,wt,n),z(this,Xt,o),z(this,ft,a),w(this,Ct,es).call(this)}static addNewStream(n){if(!Array.isArray(window.currentStreams)){window.currentStreams=[n];return}window.currentStreams=[...window.currentStreams,n]}static stopAllStreams(){if(!Array.isArray(window.currentStreams)){window.currentStreams=[];return}window.currentStreams.forEach(n=>{n.active&&n.getTracks().forEach(o=>o.stop())})}async launch(){z(this,Kt,await w(this,Ct,ns).call(this)),Ln.addNewStream(f(this,Kt)),f(this,wt).srcObject=f(this,Kt),f(this,wt).play(),w(this,Ct,cn).call(this)}stop(){f(this,wt)&&(f(this,wt).srcObject=null,z(this,le,!1)),f(this,Kt)instanceof MediaStream&&f(this,Kt).getTracks().forEach(n=>{n.stop()}),w(this,Ct,cn).call(this)}async takePicture(){if(!(f(this,Yt)&&f(this,Jt)))return null;const n=f(this,ft).getContext("2d");return f(this,ft).width=f(this,Yt),f(this,ft).height=f(this,Jt),n.drawImage(f(this,wt),0,0,f(this,Yt),f(this,Jt)),await new Promise(o=>{f(this,ft).toBlob(a=>o(a))})}addCheeseButtonListener(n,o){z(this,Fe,document.querySelector(n)),f(this,Fe).onclick=o}};Kt=new WeakMap,le=new WeakMap,Yt=new WeakMap,Jt=new WeakMap,wt=new WeakMap,Xt=new WeakMap,ft=new WeakMap,Fe=new WeakMap,Ct=new WeakSet,es=function(){f(this,wt).oncanplay=()=>{f(this,le)||(z(this,Jt,f(this,wt).videoHeight*f(this,Yt)/f(this,wt).videoWidth),f(this,ft).setAttribute("width",f(this,Yt)),f(this,ft).setAttribute("height",f(this,Jt)),z(this,le,!0))},f(this,Xt).onchange=async()=>{await this.stop(),await this.launch()}},is=async function(n){try{if(!(n instanceof MediaStream))return Promise.reject(Error("MediaStream not found!"));const{deviceId:o}=n.getVideoTracks()[0].getSettings(),u=(await navigator.mediaDevices.enumerateDevices()).filter(g=>g.kind==="videoinput").reduce((g,b,v)=>g.concat(`
            <option
              value="${b.deviceId}"
              ${o===b.deviceId?"selected":""}
            >
              ${b.label||`Camera ${v+1}`}
            </option>
          `),"");f(this,Xt).innerHTML=u}catch(o){console.error("#populateDeviceList: error:",o)}},ns=async function(){try{const n=!f(this,le)&&!f(this,Xt).value?void 0:{exact:f(this,Xt).value},o=await navigator.mediaDevices.getUserMedia({video:{aspectRatio:4/3,deviceId:n}});return await w(this,Ct,is).call(this,o),o}catch(n){return console.error("#getStream: error:",n),null}},cn=function(){const n=f(this,ft).getContext("2d");n.fillStyle="#AAAAAA",n.fillRect(0,0,f(this,ft).width,f(this,ft).height)};let ln=Ln;function Za(d,n="",o=512){const a=atob(d),l=[];for(let u=0;u<a.length;u+=o){const g=a.slice(u,u+o),b=new Array(g.length);for(let A=0;A<g.length;A++)b[A]=g.charCodeAt(A);const v=new Uint8Array(b);l.push(v)}return new Blob(l,{type:n})}function Fa(d){const n="=".repeat((4-d.length%4)%4),o=(d+n).replace(/-/g,"+").replace(/_/g,"/"),a=atob(o),l=new Uint8Array(a.length);for(let u=0;u<a.length;u++)l[u]=a.charCodeAt(u);return l}var mt,zt,Qt,pn,gn,q,os,ss,rs,as,ls,hn,un,hi;class Ha{constructor(n={}){I(this,q);I(this,mt);I(this,zt,!1);I(this,Qt,null);I(this,pn);I(this,gn);this.onImageCapture=n.onImageCapture||(()=>{}),this.onError=n.onError||(o=>console.error(o))}render(){return`
      <div class="form-group">
        <label class="required" for="photo-input">Photo</label>
        <div class="file-input-wrapper">
          <div class="file-input-options">
            <button id="photo-input-button" class="btn btn-outline" type="button">
              Upload from Device
            </button>
            <input 
              id="photo-input" 
              name="photo" 
              type="file" 
              accept="image/*"
              hidden="hidden"
            />
            <label for="photo-input" class="visually-hidden">Upload photo</label>
            <button id="open-camera-button" class="btn btn-outline" type="button">
              Take Photo
            </button>
          </div>
          
          <div id="camera-container" class="camera-container">
            <video id="camera-video" class="camera-video">
              Video stream not available.
            </video>
            <canvas id="camera-canvas" class="camera-canvas"></canvas>
            
            <div class="camera-tools">
              <label for="camera-select" class="visually-hidden">Choose camera</label>
              <select id="camera-select"></select>
              <div class="camera-tools-buttons">
                <button id="camera-take-button" class="btn" type="button">
                  Take Photo
                </button>
              </div>
            </div>
          </div>
          
          <div id="image-preview" class="image-preview" style="display: none;">
            <img id="preview-img" alt="Preview" />
            <div class="preview-actions">
              <button type="button" class="btn btn-secondary" id="remove-image-btn">
                Remove
              </button>
            </div>
          </div>
          
          <small class="file-info">Max size: 1MB. Supported formats: JPG, PNG, GIF</small>
        </div>
      </div>
    `}afterRender(){w(this,q,os).call(this),w(this,q,ss).call(this),w(this,q,rs).call(this)}getCapturedImage(){return f(this,Qt)}resetCamera(){if(w(this,q,un).call(this),f(this,zt)){const n=document.getElementById("camera-container"),o=document.getElementById("open-camera-button");n&&n.classList.remove("open"),o&&(o.textContent="Take Photo"),f(this,mt)&&f(this,mt).stop(),z(this,zt,!1)}}isCameraOpen(){return f(this,zt)}stopCamera(){f(this,mt)&&f(this,mt).stop()}}mt=new WeakMap,zt=new WeakMap,Qt=new WeakMap,pn=new WeakMap,gn=new WeakMap,q=new WeakSet,os=function(){try{z(this,mt,new ln({video:document.getElementById("camera-video"),cameraSelect:document.getElementById("camera-select"),canvas:document.getElementById("camera-canvas")})),f(this,mt).addCheeseButtonListener("#camera-take-button",async()=>{try{const a=await f(this,mt).takePicture();await w(this,q,ls).call(this,a)}catch(a){console.error("Camera capture error:",a),w(this,q,hi).call(this,"Failed to take picture: "+a.message,"error")}});const n=document.getElementById("camera-container");document.getElementById("open-camera-button").addEventListener("click",async a=>{if(n.classList.toggle("open"),z(this,zt,n.classList.contains("open")),f(this,zt)){a.currentTarget.textContent="Close Camera";try{await f(this,mt).launch()}catch(l){console.error("Camera launch error:",l),w(this,q,hi).call(this,"Failed to start camera: "+l.message,"error"),z(this,zt,!1),n.classList.remove("open"),a.currentTarget.textContent="Take Photo"}}else a.currentTarget.textContent="Take Photo",f(this,mt).stop()})}catch(n){console.error("Camera setup error:",n),w(this,q,hi).call(this,"Camera setup failed. Upload from device is still available.","warning")}},ss=function(){document.getElementById("photo-input-button").addEventListener("click",()=>{document.getElementById("photo-input").click()}),document.getElementById("photo-input").addEventListener("change",async n=>{const o=n.target.files[0];o&&await w(this,q,as).call(this,o)})},rs=function(){document.getElementById("remove-image-btn").addEventListener("click",()=>{w(this,q,un).call(this)})},as=async function(n){try{z(this,Qt,n),w(this,q,hn).call(this,URL.createObjectURL(n)),this.onImageCapture(n,"file")}catch(o){console.error("File validation error:",o),this.onError(o)}},ls=async function(n){try{let o=n;typeof n=="string"&&(o=await Za(n,"image/png")),z(this,Qt,new File([o],`camera-${Date.now()}.png`,{type:"image/png"})),w(this,q,hn).call(this,URL.createObjectURL(o)),document.getElementById("camera-container").classList.remove("open"),document.getElementById("open-camera-button").textContent="Take Photo",f(this,mt).stop(),z(this,zt,!1),this.onImageCapture(f(this,Qt),"camera")}catch(o){console.error("Camera capture processing error:",o),this.onError(o)}},hn=function(n){const o=document.getElementById("image-preview"),a=document.getElementById("preview-img");o&&a&&(a.src=n,o.style.display="block")},un=function(){const n=document.getElementById("image-preview"),o=document.getElementById("preview-img"),a=document.getElementById("photo-input");o&&o.src.startsWith("blob:")&&URL.revokeObjectURL(o.src),o&&(o.src=""),n&&(n.style.display="none"),a&&(a.value=""),z(this,Qt,null),this.onImageCapture(null,"removed")},hi=function(n,o){const a=document.createElement("div"),l=o==="error"?"error-message":o==="warning"?"warning-message":"success-message";a.className=l,a.textContent=n,a.style.padding="10px",a.style.marginBottom="15px",a.style.borderRadius="4px",a.style.border="1px solid",a.style.position="fixed",a.style.top="20px",a.style.right="20px",a.style.zIndex="9999",a.style.maxWidth="300px",o==="error"?(a.style.backgroundColor="#f8d7da",a.style.color="#721c24",a.style.borderColor="#f5c6cb"):o==="warning"?(a.style.backgroundColor="#fff3cd",a.style.color="#856404",a.style.borderColor="#ffeaa7"):(a.style.backgroundColor="#d4edda",a.style.color="#155724",a.style.borderColor="#c3e6cb"),document.body.appendChild(a),setTimeout(()=>{a.parentNode&&a.remove()},5e3)};var Y,tt,kt,_n,V,cs,hs,us,jt,ds,dn;class Ua{constructor(n={}){I(this,V);I(this,Y,null);I(this,tt,null);I(this,kt,!1);I(this,_n,null);this.onLocationChange=n.onLocationChange||(()=>{}),this.onError=n.onError||(o=>console.error(o)),this.initialLatitude=n.initialLatitude||null,this.initialLongitude=n.initialLongitude||null}render(){return`
      <div class="form-group">
        <div class="location-title">Location (Optional)</div>
        <div class="location-inputs">
          <div class="location-input">
            <label for="lat-input">Latitude</label>
            <input type="number" id="lat-input" name="latitude" placeholder="Latitude" readonly step="any" value="${this.initialLatitude||""}" />
          </div>
          <div class="location-input">
            <label for="lon-input">Longitude</label>
            <input type="number" id="lon-input" name="longitude" placeholder="Longitude" readonly step="any" value="${this.initialLongitude||""}" />
          </div>
        </div>
        <button type="button" id="get-location-btn" class="btn btn-outline">
          Use Current Location
        </button>
        <button type="button" id="init-map-btn" class="btn btn-secondary">
          Show Map
        </button>
        
        <div class="map-wrapper" style="margin-top: 15px;">
          <div id="map-loading-container" style="display: none;">
            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 4px;">
              Loading map...
            </div>
          </div>
          <div id="map-container" style="display: none;">
            <div id="map" style="height: 350px; width: 100%; border-radius: 4px; border: 1px solid #dee2e6;"></div>
          </div>
          <div id="map-error" style="display: none;">
            <div style="text-align: center; padding: 20px; background: #f8d7da; color: #721c24; border-radius: 4px; border: 1px solid #f5c6cb;">
              <strong>Map Error:</strong> <span id="map-error-message"></span>
            </div>
          </div>
        </div>
      </div>
    `}afterRender(){w(this,V,cs).call(this),this.initialLatitude&&this.initialLongitude&&w(this,V,jt).call(this,this.initialLatitude,this.initialLongitude)}getLocation(){const n=document.getElementById("lat-input"),o=document.getElementById("lon-input");return n&&o&&n.value&&o.value?{latitude:parseFloat(n.value),longitude:parseFloat(o.value)}:null}setLocation(n,o){w(this,V,jt).call(this,n,o),f(this,kt)&&f(this,Y)&&w(this,V,dn).call(this,n,o)}resetLocation(){const n=document.getElementById("lat-input"),o=document.getElementById("lon-input");if(n&&(n.value=""),o&&(o.value=""),f(this,kt)&&f(this,Y))try{const a=f(this,Y).getCenter();a&&w(this,V,jt).call(this,a.latitude,a.longitude)}catch(a){console.error("Error resetting map:",a)}}isMapInitialized(){return f(this,kt)}destroy(){f(this,Y)&&typeof f(this,Y).destroy=="function"&&f(this,Y).destroy(),z(this,Y,null),z(this,tt,null),z(this,kt,!1)}}Y=new WeakMap,tt=new WeakMap,kt=new WeakMap,_n=new WeakMap,V=new WeakSet,cs=function(){const n=document.getElementById("get-location-btn");n&&n.addEventListener("click",()=>{w(this,V,ds).call(this)});const o=document.getElementById("init-map-btn");o&&o.addEventListener("click",async()=>{f(this,kt)?w(this,V,us).call(this):await w(this,V,hs).call(this)})},hs=async function(){const n=document.getElementById("init-map-btn"),o=document.getElementById("map-loading-container"),a=document.getElementById("map-container"),l=document.getElementById("map-error");o.style.display="block",a.style.display="none",l.style.display="none",n.disabled=!0,n.textContent="Loading Map...";try{if(console.log("Starting map initialization..."),await new Promise(A=>setTimeout(A,300)),!document.getElementById("map"))throw new Error("Map element not found in DOM");a.style.display="block",o.style.display="none",await new Promise(A=>setTimeout(A,100)),console.log("Building map with Map.build...");const g=this.getLocation(),b={zoom:13};if(g&&g.latitude&&g.longitude?(console.log("Using existing coordinates:",g),b.center=[g.latitude,g.longitude]):(console.log("No existing coordinates found, using locate feature"),b.locate=!0),z(this,Y,await Jo.build("#map",b)),!f(this,Y))throw new Error("Map.build returned null or undefined");console.log("Map built successfully:",f(this,Y));const v=f(this,Y).getCenter();v&&v.latitude!==void 0&&v.longitude!==void 0&&((!g||!g.latitude||!g.longitude)&&w(this,V,jt).call(this,v.latitude,v.longitude),z(this,tt,f(this,Y).addMarker([v.latitude,v.longitude],{draggable:!0})),console.log("Marker added:",f(this,tt)),f(this,tt)&&typeof f(this,tt).on=="function"&&f(this,tt).on("dragend",A=>{console.log("Marker moved");const W=A.target.getLatLng();w(this,V,jt).call(this,W.lat,W.lng)})),z(this,kt,!0),n.textContent="Hide Map",n.disabled=!1,console.log("Map initialization completed successfully")}catch(u){console.error("Map initialization failed:",u),a.style.display="none",l.style.display="block";const g=document.getElementById("map-error-message");g&&(g.textContent=u.message),n.disabled=!1,n.textContent="Retry Map",z(this,kt,!1),this.onError&&typeof this.onError=="function"&&this.onError(u)}finally{o.style.display="none"}},us=function(){const n=document.getElementById("map-container"),o=document.getElementById("init-map-btn");n&&o&&(n.style.display==="none"?(n.style.display="block",o.textContent="Hide Map"):(n.style.display="none",o.textContent="Show Map"))},jt=function(n,o){const a=document.getElementById("lat-input"),l=document.getElementById("lon-input");if(a&&l){const u=parseFloat(n).toFixed(6),g=parseFloat(o).toFixed(6);a.value=u,l.value=g,this.onLocationChange({latitude:u,longitude:g})}},ds=function(){if(!navigator.geolocation){this.onError(new Error("Geolocation is not supported by this browser"));return}const n=document.getElementById("get-location-btn");n&&(n.disabled=!0,n.textContent="Getting location...",navigator.geolocation.getCurrentPosition(o=>{const a=o.coords.latitude,l=o.coords.longitude;w(this,V,jt).call(this,a,l),f(this,kt)&&f(this,Y)&&w(this,V,dn).call(this,a,l),n.disabled=!1,n.textContent="Use Current Location",this.onLocationChange({latitude:a,longitude:l,accuracy:o.coords.accuracy,message:`Location updated! Accuracy: ¬±${Math.round(o.coords.accuracy)}m`})},o=>{n.disabled=!1,n.textContent="Use Current Location";let a="Unable to get location: ";switch(o.code){case o.PERMISSION_DENIED:a+="Location access denied by user.";break;case o.POSITION_UNAVAILABLE:a+="Location information unavailable.";break;case o.TIMEOUT:a+="Location request timed out.";break;default:a+=o.message}this.onError(new Error(a))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4}))},dn=function(n,o){if(f(this,Y))try{f(this,Y).changeCamera([n,o],15),f(this,tt)&&typeof f(this,tt).remove=="function"&&f(this,tt).remove(),z(this,tt,f(this,Y).addMarker([n,o],{draggable:!0})),f(this,tt)&&typeof f(this,tt).on=="function"&&f(this,tt).on("dragend",a=>{const l=a.target.getLatLng();w(this,V,jt).call(this,l.lat,l.lng)}),console.log("Map updated with new location:",n,o)}catch(a){console.error("Error updating map with location:",a),this.onError(new Error("Failed to update map with location"))}};class ci{constructor(n={}){this.apiBaseUrl=qt.BASE_URL,this.token=n.token}setToken(n){this.token=n}setApiBaseUrl(n){this.apiBaseUrl=n}async addStory(n){if(!this.token)throw new Error("Authentication token is required for this operation");const o=`${this.apiBaseUrl}/stories`,a={method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:n};try{const l=await fetch(o,a);if(!l.ok){const u=await l.json().catch(()=>({}));throw new Error(u.message||`HTTP error! status: ${l.status}`)}return await l.json()}catch(l){throw console.error("Error adding story:",l),l}}async addStoryGuest(n){const o=`${this.apiBaseUrl}/stories/guest`,a={method:"POST",body:n};try{const l=await fetch(o,a);if(!l.ok){const u=await l.json().catch(()=>({}));throw new Error(u.message||`HTTP error! status: ${l.status}`)}return await l.json()}catch(l){throw console.error("Error adding guest story:",l),l}}async submitStory(n,o=!1){return o?await this.addStoryGuest(n):await this.addStory(n)}static validateImageFile(n,o=1024*1024){if(!n)return{isValid:!0};if(n.size>o){const a=(n.size/1048576).toFixed(2),l=(o/(1024*1024)).toFixed(2);return{isValid:!1,error:`File size too large: ${a}MB. Maximum allowed size is ${l}MB.`}}return n.type.startsWith("image/")?{isValid:!0}:{isValid:!1,error:"File must be a valid image file."}}static createFormData(n){const o=new FormData;return n.description&&o.append("description",n.description),n.photo&&o.append("photo",n.photo),n.lat!==void 0&&n.lat!==null&&n.lat!==""&&o.append("lat",n.lat),n.lon!==void 0&&n.lon!==null&&n.lon!==""&&o.append("lon",n.lon),o}}var ct,bt,et,Ht,M,fs,ms,ps,gs,_s,vs,ys,ws,bs,fn,$t,Ls,xs,mn;class qa{constructor(n={}){I(this,M);I(this,ct);I(this,bt);I(this,et);I(this,Ht);this.isGuest=n.isGuest||!1,this.token=n.token||ht.getToken(),this.onSuccess=n.onSuccess||(()=>{}),this.onError=n.onError||(o=>console.error(o)),this.onGuestModeChange=n.onGuestModeChange||(()=>{}),this.maxFileSize=1024*1024,this.validator=new Na,console.log("form page",this.token),z(this,Ht,new ci({token:this.token}))}async render(){return`
      <section class="container">
        <div class="add-story-form">
          <h1>Add New Story</h1>
          
          <!-- Login Mode Selection -->
          <div class="form-group login-mode-selection">
            <label for="login-mode">Login Mode</label>
            <select id="login-mode" name="login-mode" class="form-select">
              <option value="authenticated" ${this.isGuest?"":"selected"}>
                Login with Account
              </option>
              <option value="guest" ${this.isGuest?"selected":""}>
                Login as Guest
              </option>
            </select>
            <div class="login-mode-info">
              <small id="login-mode-description">
                ${this.isGuest?"You are posting as a guest. Your story will be public but not linked to an account.":"You are logged in with your account. Your story will be saved to your profile."}
              </small>
            </div>
          </div>
          
          <form id="story-form" class="story-form">
            <div class="form-group">
              <label for="description" class="required">Description</label>
              <textarea 
                id="description" 
                name="description" 
                placeholder="Tell your story..." 
                required
                rows="4"
              ></textarea>
              <div class="field-info">
                <small>Minimum 10 characters, maximum 500 characters</small>
                <div class="char-counter" id="char-counter">0/500</div>
              </div>
            </div>

            <!-- Guest Information Section -->
            <div id="guest-info-section" class="form-group guest-section" ${this.isGuest?"":'style="display: none;"'}>
              <label for="guest-name">Name (Optional for Guest)</label>
              <input 
                type="text" 
                id="guest-name" 
                name="guest-name" 
                placeholder="Enter your name (optional)"
                maxlength="50"
              />
              <div class="field-info">
                <small>Optional: Add your name to be displayed with the story</small>
              </div>
            </div>

            <div id="camera-component-container"></div>

            <div id="map-form-container"></div>

            <div class="form-actions">
              <span id="submit-button-container">
                <button class="btn" type="submit">
                  ${this.isGuest?"Add Story as Guest":"Add Story"}
                </button>
              </span>
              <button type="button" class="btn btn-outline" id="cancel-btn">Cancel</button>
            </div>
          </form>
        </div>
      </section>
    `}async afterRender(){console.log("AfterRender started"),w(this,M,fs).call(this),console.log("Form setup completed"),w(this,M,ms).call(this),console.log("Login mode selection setup completed"),w(this,M,ps).call(this),console.log("Camera component setup completed"),w(this,M,gs).call(this),console.log("Map form component setup completed"),console.log("AfterRender completed")}setToken(n){this.token=n,this.isGuest=!n,f(this,Ht).setToken(n),w(this,M,mn).call(this)}setGuestMode(n){this.isGuest=n,w(this,M,mn).call(this)}setApiBaseUrl(n){f(this,Ht).setApiBaseUrl(n)}setInitialLocation(n,o){f(this,et)&&f(this,et).setLocation(n,o)}getLocation(){return f(this,et)?f(this,et).getLocation():null}getGuestMode(){return this.isGuest}getGuestName(){if(this.isGuest){const n=document.getElementById("guest-name");return n?n.value.trim():""}return""}setMaxFileSize(n){this.maxFileSize=n}getMaxFileSizeMB(){return(this.maxFileSize/(1024*1024)).toFixed(2)}destroy(){f(this,et)&&f(this,et).destroy()}}ct=new WeakMap,bt=new WeakMap,et=new WeakMap,Ht=new WeakMap,M=new WeakSet,fs=function(){z(this,ct,document.getElementById("story-form")),f(this,ct).addEventListener("submit",async a=>{a.preventDefault(),await w(this,M,ys).call(this)});const n=document.getElementById("description"),o=document.getElementById("char-counter");n.addEventListener("input",a=>{const l=a.target.value.length;o.textContent=`${l}/500`,o.style.color=l>500?"#dc2626":l>450?"#f59e0b":"#6b7280"}),document.getElementById("cancel-btn").addEventListener("click",()=>{w(this,M,fn).call(this)})},ms=function(){const n=document.getElementById("login-mode"),o=document.getElementById("login-mode-description"),a=document.getElementById("guest-info-section"),l=document.querySelector("#submit-button-container button");n.addEventListener("change",u=>{const g=u.target.value,b=this.isGuest;this.isGuest=g==="guest",this.isGuest?(o.textContent="You are posting as a guest. Your story will be public but not linked to an account.",a.style.display="block",l&&(l.textContent="Add Story as Guest")):(o.textContent="You are logged in with your account. Your story will be saved to your profile.",a.style.display="none",l&&(l.textContent="Add Story")),f(this,Ht)&&f(this,Ht).setGuestMode(this.isGuest),b!==this.isGuest&&this.onGuestModeChange(this.isGuest),console.log("Login mode changed to:",g,"isGuest:",this.isGuest)})},ps=function(){z(this,bt,new Ha({onImageCapture:(o,a)=>{w(this,M,_s).call(this,o,a)},onError:o=>{w(this,M,$t).call(this,o.message||"Camera error occurred","error")}}));const n=document.getElementById("camera-component-container");n&&(n.innerHTML=f(this,bt).render(),f(this,bt).afterRender())},gs=function(){z(this,et,new Ua({onLocationChange:o=>{w(this,M,vs).call(this,o)},onError:o=>{w(this,M,$t).call(this,o.message||"Map error occurred","error")}}));const n=document.getElementById("map-form-container");n&&(n.innerHTML=f(this,et).render(),f(this,et).afterRender())},_s=function(n,o){if(console.log("Image captured from:",o,n),o==="removed")console.log("Image removed");else if(n){const a=ci.validateImageFile(n,this.maxFileSize);a.isValid?console.log("New image selected:",(n==null?void 0:n.name)||"unknown"):(w(this,M,$t).call(this,a.error,"error"),f(this,bt)&&setTimeout(()=>{f(this,bt).resetCamera()},100))}},vs=function(n){n.message&&w(this,M,$t).call(this,n.message,"success")},ys=async function(){try{const n=await w(this,M,ws).call(this);if(!n.isValid){w(this,M,$t).call(this,this.validator.getValidationSummary(n),"error");return}w(this,M,Ls).call(this);const o=w(this,M,bs).call(this),a=ci.createFormData(o),l=await f(this,Ht).submitStory(a,this.isGuest);if(l.error===!1){const u=this.isGuest?"Story added successfully as guest!":"Story added successfully!";w(this,M,$t).call(this,u,"success"),w(this,M,fn).call(this),this.onSuccess(l),setTimeout(()=>{window.location.hash="#/"},1500)}else throw new Error(l.message||"Failed to add story")}catch(n){console.error("Submission error:",n),w(this,M,$t).call(this,this.validator.parseNetworkError?this.validator.parseNetworkError(n):n.message,"error"),this.onError(n)}finally{w(this,M,xs).call(this)}},ws=async function(){var n;try{const o=f(this,et).getLocation(),a=f(this,bt).getCapturedImage();if(a){const u=ci.validateImageFile(a,this.maxFileSize);if(!u.isValid)return{isValid:!1,errors:[u.error]}}const l={description:f(this,ct).elements.namedItem("description").value,photo:a,lat:o?o.latitude:"",lon:o?o.longitude:"",guestName:this.isGuest&&((n=f(this,ct).elements.namedItem("guest-name"))==null?void 0:n.value)||""};return this.validator.validateForm(l)}catch(o){return console.error("Form validation error:",o),{isValid:!1,errors:["Form validation failed"]}}},bs=function(){const n=f(this,et).getLocation(),o=f(this,bt).getCapturedImage(),a={description:f(this,ct).elements.namedItem("description").value,photo:o,lat:n?n.latitude:null,lon:n?n.longitude:null,isGuest:this.isGuest};if(this.isGuest){const l=f(this,ct).elements.namedItem("guest-name");a.guestName=l?l.value.trim():""}return a},fn=function(){if(!f(this,ct))return;f(this,ct).reset(),f(this,bt)&&f(this,bt).resetCamera(),f(this,et)&&f(this,et).resetLocation();const n=document.getElementById("char-counter");n&&(n.textContent="0/500",n.style.color="#6b7280");const o=document.getElementById("login-mode");o&&(o.value=this.isGuest?"guest":"authenticated")},$t=function(n,o){if(!f(this,ct))return;const a=f(this,ct).querySelector(".error-message, .success-message, .warning-message");a&&a.remove();const l=document.createElement("div"),u=o==="error"?"error-message":o==="warning"?"warning-message":"success-message";l.className=u,l.textContent=n,l.style.padding="10px",l.style.marginBottom="15px",l.style.borderRadius="4px",l.style.border="1px solid",o==="error"?(l.style.backgroundColor="#f8d7da",l.style.color="#721c24",l.style.borderColor="#f5c6cb"):o==="warning"?(l.style.backgroundColor="#fff3cd",l.style.color="#856404",l.style.borderColor="#ffeaa7"):(l.style.backgroundColor="#d4edda",l.style.color="#155724",l.style.borderColor="#c3e6cb"),f(this,ct).appendChild(l),(o==="success"||o==="warning")&&setTimeout(()=>{l.parentNode&&l.remove()},5e3)},Ls=function(){const n=document.getElementById("submit-button-container");if(n){const o=this.isGuest?"Adding Story as Guest...":"Adding Story...";n.innerHTML=`
        <button class="btn" type="submit" disabled style="opacity: 0.6;">
          ${o}
        </button>
      `}},xs=function(){const n=document.getElementById("submit-button-container");if(n){const o=this.isGuest?"Add Story as Guest":"Add Story";n.innerHTML=`
        <button class="btn" type="submit">${o}</button>
      `}},mn=function(){const n=document.getElementById("login-mode"),o=document.getElementById("guest-info-section"),a=document.querySelector("#submit-button-container button"),l=document.getElementById("login-mode-description");n&&(n.value=this.isGuest?"guest":"authenticated"),o&&(o.style.display=this.isGuest?"block":"none"),a&&(a.textContent=this.isGuest?"Add Story as Guest":"Add Story"),l&&(l.textContent=this.isGuest?"You are posting as a guest. Your story will be public but not linked to an account.":"You are logged in with your account. Your story will be saved to your profile.")};class Wa{constructor(){this._objectUrls=[]}render(){return`
            <section class="saved-stories">
                <div class="page-header">
                    <h1 class="page-title">Story Tersimpan</h1>
                    <p class="page-subtitle">Koleksi cerita yang sudah kamu simpan (tersedia offline)</p>
                </div>
                <div id="saved-stories-content" class="saved-stories__content">
                    <p>Memuat story tersimpan...</p>
                </div>
            </section>
        `}async afterRender(){await this.loadSavedStories(),this.setupEventListeners()}cleanupObjectUrls(){this._objectUrls&&this._objectUrls.length&&this._objectUrls.forEach(n=>{try{URL.revokeObjectURL(n)}catch{}}),this._objectUrls=[]}async loadSavedStories(){const n=document.getElementById("saved-stories-content");try{this.cleanupObjectUrls();const o=await Ze.getAllStory();if(console.log("sukses"),console.log(o),!o){console.warn("savedStories is null or undefined"),n.innerHTML="<p>Gagal memuat data story</p>";return}const l=(Array.isArray(o)?o:[]).map(u=>{const g={...u};if(g.photoBlob instanceof Blob){const b=URL.createObjectURL(g.photoBlob);this._objectUrls.push(b),g._photoSrc=b}else typeof g.photoUrl=="string"&&g.photoUrl.length>0?g._photoSrc=g.photoUrl:g._photoSrc=null;return g});l.length===0?n.innerHTML=this.renderEmptyState():n.innerHTML=this.renderStoriesList(l)}catch(o){console.error("Error loading saved stories:",o),n.innerHTML="<p>Gagal memuat data story</p>"}}renderEmptyState(){return`
            <div class="empty-state">
                <h3>Belum Ada Story Tersimpan</h3>
                <p>Story yang kamu simpan akan muncul di halaman ini.</p>
                <button class="btn" onclick="window.location.hash = '#/'">Jelajahi Story</button>
            </div>
        `}renderStoriesList(n){const o=n.map(a=>{const l={id:a.id||"unknown",name:a.name||"Nama tidak tersedia",description:a.description||"Deskripsi tidak tersedia",lat:a.lat||null,lon:a.lon||null,createdAt:a.createdAt||new Date().toISOString(),photoSrc:a._photoSrc||null};return`
                <article class="saved-story-card" data-story-id="${l.id}">
                    ${l.photoSrc?`
                      <div class="saved-story-card__image">
                        <img src="${l.photoSrc}" alt="${this.escapeHtml(l.name)}" loading="lazy">
                      </div>
                    `:""}
                    <header class="saved-story-card__header">
                        <h3>${this.escapeHtml(l.name)}</h3>
                        <span class="saved-story-card__date">${this.formatDate(l.createdAt)}</span>
                    </header>
                    <p class="saved-story-card__description">${this.escapeHtml(l.description)}</p>
                    <p class="saved-story-card__meta">Lokasi: ${l.lat&&l.lon?`${l.lat}, ${l.lon}`:"Tidak tersedia"}</p>
                    <div class="saved-story-card__actions">
                        <button class="btn btn-outline view-detail-btn" data-story='${this.escapeHtml(JSON.stringify({id:l.id,name:l.name,description:l.description,lat:l.lat,lon:l.lon,createdAt:l.createdAt}))}'>Lihat Detail</button>
                        <button class="btn btn-secondary delete-story-btn" data-story-id="${l.id}">Hapus</button>
                    </div>
                </article>
            `}).join("");return`
            <div class="stories-container saved-stories__list">
                <p class="saved-stories__count">${n.length} story tersimpan (tersedia offline)</p>
                ${o}
            </div>
        `}escapeHtml(n){const o=document.createElement("div");return o.textContent=n,o.innerHTML}formatDate(n){try{const o=new Date(n);return isNaN(o.getTime())?"Tanggal tidak valid":o.toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(o){return console.error("Error formatting date:",o),"Tanggal tidak valid"}}setupEventListeners(){const n=document.getElementById("saved-stories-content");n&&(n.addEventListener("click",o=>{if(o.target.classList.contains("view-detail-btn")){const a=o.target.getAttribute("data-story");if(a)try{const l=JSON.parse(a);this.viewStoryDetail(l)}catch(l){console.error("Error parsing story data:",l),alert("Gagal memuat detail story")}}}),n.addEventListener("click",o=>{if(o.target.classList.contains("delete-story-btn")){const a=o.target.getAttribute("data-story-id");a&&this.confirmDeleteStory(a)}}))}viewStoryDetail(n){console.log("Viewing story detail:",n),window.location.hash=`#/story/${n.id}`}async confirmDeleteStory(n){if(confirm("Apakah Anda yakin ingin menghapus story ini?"))try{await Ze.removeStory(n),await this.loadSavedStories(),alert("Story berhasil dihapus")}catch(o){console.error("Error deleting story:",o),alert("Gagal menghapus story")}}}const Ga={"/":new Ea,"/about":new Ma,"/register":new Ba,"/login":new Ra,"/addstory":new qa,"/wishlist":new Wa};function Va(d){const n=d.split("/");return{resource:n[1]||null,id:n[2]||null}}function ja(d){let n="";return d.resource&&(n=n.concat(`/${d.resource}`)),d.id&&(n=n.concat("/:id")),n||"/"}function $a(){return location.hash.replace("#","")||"/"}function Ka(){const d=$a(),n=Va(d);return ja(n)}const Ss={SUBSCRIBE:`${qt.BASE_URL}/notifications/subscribe`,UNSUBSCRIBE:`${qt.BASE_URL}/notifications/subscribe`};async function Ps({endpoint:d,keys:{p256dh:n,auth:o}}){const a=ht.getToken(),l=JSON.stringify({endpoint:d,keys:{p256dh:n,auth:o}}),u=await fetch(Ss.SUBSCRIBE,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:l});return{...await u.json(),ok:u.ok}}async function Ya({endpoint:d}){const n=ht.getToken(),o=JSON.stringify({endpoint:d}),a=await fetch(Ss.UNSUBSCRIBE,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:o});return{...await a.json(),ok:a.ok}}function Ts(){return"Notification"in window&&"serviceWorker"in navigator}function Ja(){return Notification.permission==="granted"}async function Xa(){if(!Ts())return console.error("Notification API unsupported."),!1;if(Ja())return!0;const d=await Notification.requestPermission();return d==="denied"?(alert("Izin notifikasi ditolak."),!1):d==="default"?(alert("Izin notifikasi ditutup atau diabaikan."),!1):!0}async function ks(){try{return await(await navigator.serviceWorker.ready).pushManager.getSubscription()}catch(d){return console.error("getPushSubscription error:",d),null}}async function Cs(){return!!await ks()}function Qa(){return{userVisibleOnly:!0,applicationServerKey:Fa(qt.VAPID_API_KEY)}}async function tl(){if(!Ts())return alert("Browser tidak mendukung Notification API atau Service Worker."),!1;if(!await Xa())return!1;if(await Cs())return alert("Sudah berlangganan push notification."),!0;console.log("Mulai berlangganan push notification...");const d="Langganan push notification gagal diaktifkan.",n="Langganan push notification berhasil diaktifkan.";let o=null;try{o=await(await navigator.serviceWorker.ready).pushManager.subscribe(Qa());const{endpoint:l,keys:u}=o.toJSON(),g=await Ps({endpoint:l,keys:u});if(!g.ok){if(console.error("subscribe: response:",g),alert(d),o)try{await o.unsubscribe()}catch(b){console.error("Error unsubscribing after failed API call:",b)}return}return alert(n),!0}catch(a){if(console.error("subscribe: error:",a),alert(d),o)try{await o.unsubscribe()}catch(l){console.error("Error unsubscribing after subscription error:",l)}return!1}return!1}async function el(){const d="Langganan push notification gagal dinonaktifkan.",n="Langganan push notification berhasil dinonaktifkan.";try{const o=await ks();if(!o)return alert("Tidak bisa memutus langganan push notification karena belum berlangganan sebelumnya."),!1;const{endpoint:a,keys:l}=o.toJSON(),u=await Ya({endpoint:a});if(!u.ok)return alert(d),console.error("unsubscribe: response:",u),!1;if(!await o.unsubscribe()){alert(d);try{await Ps({endpoint:a,keys:l})}catch(b){console.error("Error re-subscribing after failed local unsubscription:",b)}return!1}return alert(n),!0}catch(o){return alert(d),console.error("unsubscribe: error:",o),!1}}var He,we,Ut,Lt,Es,Ms,As,ui;class il{constructor({navigationDrawer:n,drawerButton:o,content:a}){I(this,Lt);I(this,He,null);I(this,we,null);I(this,Ut,null);z(this,He,a),z(this,we,o),z(this,Ut,n),w(this,Lt,Es).call(this)}async renderPage(){const n=Ka(),o=Ga[n],a=async()=>{f(this,He).innerHTML=await o.render(),await o.afterRender(),w(this,Lt,Ms).call(this),await w(this,Lt,As).call(this)};if(document.startViewTransition){const l=document.startViewTransition(()=>a());await(l==null?void 0:l.finished);return}await a()}}He=new WeakMap,we=new WeakMap,Ut=new WeakMap,Lt=new WeakSet,Es=function(){f(this,we).addEventListener("click",()=>{f(this,Ut).classList.toggle("open")}),document.body.addEventListener("click",n=>{!f(this,Ut).contains(n.target)&&!f(this,we).contains(n.target)&&f(this,Ut).classList.remove("open"),f(this,Ut).querySelectorAll("a").forEach(o=>{o.contains(n.target)&&f(this,Ut).classList.remove("open")})})},Ms=function(){const n=document.getElementById("loginUser"),o=document.getElementById("logoutUser");ht.isAuthenticated()?(n.classList.add("Gone"),o.classList.remove("Gone")):(n.classList.remove("Gone"),o.classList.add("Gone"));const a=o.querySelector("a");a&&(a.onclick=l=>{l.preventDefault(),ht.clearAuthData(),n.classList.remove("Gone"),o.classList.add("Gone"),window.location.hash="/login"})},As=async function(){const n=document.getElementById("subscribe-button"),o=document.getElementById("unsubscribe-button");n&&n.addEventListener("click",async()=>{console.log("Subscribe button clicked"),await tl(),await w(this,Lt,ui).call(this)}),o&&o.addEventListener("click",async()=>{console.log("Unsubscribe button clicked"),await el(),await w(this,Lt,ui).call(this)}),await w(this,Lt,ui).call(this)},ui=async function(){const n=document.getElementById("subscribe-button"),o=document.getElementById("unsubscribe-button"),a=!(typeof Notification<"u"&&"serviceWorker"in navigator);if(n&&o){if(a||Notification.permission==="denied"){n.style.display="inline-block",n.disabled=!0,n.textContent="Push tidak didukung / ditolak",o.style.display="none",o.disabled=!0;return}await Cs()?(n.style.display="none",n.disabled=!0,o.style.display="inline-block",o.disabled=!1):(n.style.display="inline-block",n.disabled=!1,n.textContent="Aktifkan Push",o.style.display="none",o.disabled=!0)}};function nl(){return"serviceWorker"in navigator}async function ol(){if(!nl()){console.log("Service Worker API unsupported");return}try{const d=await navigator.serviceWorker.register("/sw.js");console.log("Service worker telah terpasang",d)}catch(d){console.log("Failed to install service worker:",d)}}document.addEventListener("DOMContentLoaded",async()=>{await ol();const d=new il({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")});await d.renderPage(),window.addEventListener("hashchange",async()=>{await d.renderPage()})});
